"use strict";var asApp=angular.module("asApp",["ngAnimate","ngAria","ngResource","ngSanitize","ngTouch","angularUtils.directives.dirPagination","asApp.controllers","asApp.services","slickCarousel","angularFileUpload","infinite-scroll","sticky","vcRecaptcha",-1==navigator.userAgent.indexOf("Speed Insights")?"socialLogin":null]),controllers=angular.module("asApp.controllers",[]),services=angular.module("asApp.services",[]);asApp.config(["paginationTemplateProvider",function(e){e.setString('<ul class="pagination text-center" role="navigation" aria-label="Pagination" ng-if="1 < pages.length || !autoHide"><li ng-repeat="pageNumber in pages track by tracker(pageNumber, $index)" ng-class="{ active : pagination.current == pageNumber, disabled : pageNumber == \'...\' }"><a href="" ng-click="setCurrent(pageNumber)">{{ pageNumber }}</a></li>')}]),-1!=navigator.userAgent.indexOf("Speed Insights")||-1===document.location.href.indexOf("client")&&-1===cookiesPrivacity.indexOf("COOKIE_SOCIAL")||asApp.config(["socialProvider",function(e){e.setGoogleKey(googleId),e.setFbKey({appId:facebookId,apiVersion:facebookVersion})}]),asApp.filter("parseCharsUrl",function(){return function(e){return e=e||"",e=e.replace(new RegExp(/\s/g),"-"),e=e.replace(new RegExp(/[àáâãäå]/g),"a"),e=e.replace(new RegExp(/[èéêë]/g),"e"),e=e.replace(new RegExp(/[ìíîï]/g),"i"),e=e.replace(new RegExp(/ñ/g),"n"),e=e.replace(new RegExp(/[òóôõö]/g),"o"),e=e.replace(new RegExp(/[ùúûü]/g),"u")}}),$.fn.extend({animateCss:function(e){$(this).addClass("animated "+e).one("webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend",function(){$(this).removeClass("animated "+e)})}});var QueryString=function(){for(var e={},t=window.location.search.substring(1),o=t.split("&"),a=0;a<o.length;a++){var n=o[a].split("=");if(void 0===e[n[0]])e[n[0]]=decodeURIComponent(n[1]);else if("string"==typeof e[n[0]]){var i=[e[n[0]],decodeURIComponent(n[1])];e[n[0]]=i}else e[n[0]].push(decodeURIComponent(n[1]))}return e}(),tagEvent=function(e){"object"==typeof e&&dataLayer.push(e)},pushEventPopUp=function(e){data.literalCID?dataLayer.push({event:"pop-up",pageName:url+"/"+e,auxPageName:url,brand:pageInfo.brand,userID:data.literalCIDEncrypt,gender:data.attributes.sexo,language:data.attributes.idioma_comunicaciones,userStatus:"logado"}):dataLayer.push({event:"pop-up",pageName:url+"/"+e,auxPageName:url,brand:pageInfo.brand,userStatus:"no logado"})};$(document).foundation(),controllers.controller("accordionController",["$scope","Product",function(e,t){e.marcas=["Actimel","Activia","Danacol","Danet","Danonino","Danone","Densia","dePostre","Light & Free","Mi primer Danone","Oikos","Original","Savia","Vitalinea","YoPRO"],e.aguas=["Font Vella","Levité","Font Vella Sensación","Fonter","Lanjarón","Font Vella Té"],e.sins=["Sin gluten","Sin lactosa","Sin grasa"],e.especialidades=["Sabores","Para llevar","Para beber","Cremosos","Edulcorados","Con frutas","Naturales","Té","Postre"],e.recetas=["Comidas","Cenas","Postres","Bebidas","Meriendas","Desayunos"],e.dificultades=["Fácil","Media","Difícil"],e.secciones=[],e.tipologias=[],e.toggleAccordion=function(){e.isActive=!e.isActive},e.secciones=t.secciones,e.tipologias=t.tipologias,e.getProductTypes=function(){t.getTypeList().then(function(t){var o=t.data;o.exception?e.exception=o.exception:e.secciones(o.productTypeList)})}}]),controllers.controller("accordionItemController",["$scope",function(e){e.toggleItem=function(){e.isActive=!e.isActive}}]),controllers.controller("auctionController",["$scope","$rootScope","Auction","Consumer",function(e,t,o,a){var n=a.get,i=0,r=[{breakpoint:"small",size:"480/274",sticky:!1},{breakpoint:"medium",size:"328/187",sticky:!1},{breakpoint:"large",size:"386/220",sticky:!1}],s=[{breakpoint:"small",size:"960/716",sticky:"stickyImageMobile"},{breakpoint:"medium",size:"1488/700",sticky:"stickyImageTablet"},{breakpoint:"large",size:"2500/480",sticky:"stickyImageDesktop"}],c=[{breakpoint:"small",size:"790/450",sticky:!1},{breakpoint:"medium",size:"790/450",sticky:!1},{breakpoint:"large",size:"790/450",sticky:!1}];e.triangleOut=function(){if(window.innerWidth>=376)return{top:"-198px"}},e.triangleInn=function(){if(window.innerWidth>=376)return{top:"-222px"}},e.logged=a.getLogged(),e.stickyAuction={},e.activeAuctions=[],e.closedAuctions=[],e.nextAuctions=[],e.nearAuctionTime=null,e.category=null,e.promoted=null,e.sticky="0",e.limit=3,e.activeCountdown=!1,e.bid=o.bid,e.result=o.result,e.points=0,e.pointsVariable=0,e.featuredButton=!1,e.loading={sticky:!0,active:!0,closed:!0,next:!0,detail:!0},e.closedSlider=!1,e.closedSliderConfig={infinite:!1,arrows:!1,dots:!0,slidesToShow:1,event:{afterChange:function(e,t,o,a){dataLayer.push({event:"slide_show_subastas_cerradas",event_category:"subastas",event_action:"slide show: "+o,event_label:"subastas cerradas"})}}},e.categorySlider=!1,e.categorySliderConfig={infinite:!1,arrows:!0,dots:!1,slidesToShow:2},e.consumer=n,e.maxBid=0,e.minBid=0,e.allowBid=!0,e.auctionDetail={},e.dontShowAgain=!1,e.auctionListInit=function(){void 0!==site.isLogged.literalCID&&(l(),d(),p(),g()),void 0!==site.isLogged.literalCID&&void 0!==site.isLogged.literalCID&&(e.stickyAuction={},e.activeAuctions=[],e.closedAuctions=[],e.nextAuctions=[],e.nearAuctionTime=null,l(),d(),p(),e.logged&&g())},e.auctionDetailtInit=function(t){void 0!==site.isLogged.literalCID&&(u(t),d(),p()),void 0!==site.isLogged.literalCID&&void 0!==site.isLogged.literalCID&&(e.closedAuctions=[],e.nextAuctions=[],e.nearAuctionTime=null,u(t,!0),d(),p())},e.getAuctionWin=function(){void 0!==site.isLogged.literalCID&&(a.detail().then(function(e){var t=e.data,o=new Foundation.Reveal($("#auctionsSend"));a.add(t),o.open()},function(){}),e.send=a.getSend)};var l=function(){o.list("Active","2").then(function(t){var o=t.data,a=h(o),n=[],s={},c={};if(D(60),void 0!==o.exception)return e.exception=o.exception,e.loading.active=!0,e.loading.sticky=!0,D(3),void setTimeout(function(){l()},i);a.forEach(function(t){null!==t.nid&&v(t,e.activeAuctions)});for(var u=0;u<e.activeAuctions.length;u++)s=e.activeAuctions[u],c=s.timeToEndAuctionDate,s.totalHours=f(c),s.isSticky="1"==s.sticky,s.routeAlias=m(s.routeAlias),s.unixEndDate=R(s.endDate),s.unixStartDate=R(s.startDate),s.lastBidPoints||(s.lastBidPoints=0),null!==s.image&&""!=s.image.url&&S(s,r),s.isSticky&&n.push(s.unixEndDate),0==c.days&&0==c.h&&0==c.i&&(c.s>0?D(3):(s=k(s),p())),"existe"!=x(s,a)&&(s=k(s),p()),P(s,s.timeToEndAuctionDate),e.activeAuctions[u]=s;e.stickyAuction=b(n.sort()),e.loading.active&&(e.loading.active=!1),e.loading.sticky&&(e.loading.sticky=!1),setTimeout(function(){l()},i)},function(t){e.loading.active=!0,e.loading.sticky=!0})},u=function(t){o.list("Active","2","2").then(function(o){var a=o.data,n=h(a),r={};if(D(60),void 0!==a.exception)return e.exception=a.exception,e.loading.detail=!0,D(3),void setTimeout(function(){u(e.auctionDetail.nid)},i);n.forEach(function(t){if(null!==t.nid&&t.nid==this){if(r=t.timeToEndAuctionDate,t.totalHours=f(r),t.routeAlias="/"+t.routeAlias,t.lastBidPoints||(t.lastBidPoints=0),null!==t.image&&""!=t.image.url&&S(t,c),0==r.days&&0==r.h&&0==r.i){if(!(r.s>0))return C();D(3)}e.auctionDetail=t,e.auctionDetail.lastBidPoints=e.auctionDetail.lastBidPoints?t.lastBidPoints:0,e.literalAuction=e.auctionDetail.literalAuction,e.maxBid=parseFloat(e.auctionDetail.lastBidPoints)+parseFloat(e.auctionDetail.bidPointsMaxIncrement),e.minBid=parseFloat(e.auctionDetail.lastBidPoints)+1,e.points<=e.auctionDetail.lastBidPoints&&(e.points=parseFloat(e.auctionDetail.lastBidPoints)+1),e.allowBid=!t.finished,e.bid(e.auctionDetail),e.bid().allowBid=e.allowBid,e.bid().points=e.points,e.bid().loading=!1,P(e.auctionDetail,e.auctionDetail.timeToEndAuctionDate)}},t),void 0!==e.auctionDetail.nid&&"existe"!=x(e.auctionDetail,n)&&C(),e.loading.detail&&(e.loading.detail=!1),setTimeout(function(){u(e.auctionDetail.nid)},i)},function(t){e.loading.detail=!0})},d=function(){o.list("Next","2","2").then(function(t){var o=t.data,a=h(o),n=[],i=new Date,s=i.getTime(),c={};if(void 0!==o.exception)return e.exception=o.exception,void(e.loading.next=!0);a.forEach(function(t,o){if(null!==t.nid){var a=t.startDate.split(" ");t.unixStartDate=R(t.startDate),t.startDate={},t.startDate.date=a[0],t.startDate.time=a[1],null!==t.image&&""!=t.image.url&&S(t,r),n.push(t.unixStartDate),v(t,e.nextAuctions)}}),n.sort();for(var u=0;u<e.nextAuctions.length;u++)c=e.nextAuctions[u],c.unixStartDate===n[0]&&(e.nearAuctionTime=c),"existe"!=x(c,a)&&e.nextAuctions.splice(u,1);e.nearAuctionTime&&(e.nearAuctionTime.timeToStartAuctionDate=y(e.nearAuctionTime.unixStartDate-s),e.nearAuctionTime.callAtCountEnd=function(){l(),d()},P(e.nearAuctionTime,e.nearAuctionTime.timeToStartAuctionDate)),e.loading.next&&(e.loading.next=!1)},function(t){e.loading.next=!0})},p=function(){o.list("withHiggestBid","2","2",null,"16").then(function(t){var o=t.data,a=h(o),n=a.length,i=[],s=0;if(void 0!==o.exception)return e.exception=o.exception,void(e.loading.closed=!0);a.forEach(function(t,o){null!==t.nid&&(null!==t.image&&""!=t.image.url&&S(t,r),i.push(t),s++,4===s?(e.closedAuctions.push(i),i=[],s=0,o++):o===n-1&&e.closedAuctions.push(i))}),e.loading.closed&&(e.loading.closed=!1)},function(t){e.loading.closed=!0})};e.initTooltip=function(){var e=$("#segment-faq");if(e.length){var t=window._LNG?window._LNG.toLowerCase():"es",o=new Foundation.Tooltip(e,{disableHover:!1,allowHtml:!0,ariaHaspopup:!0,clickOpen:!1,templateClasses:"left segment-tooltip",hOffset:20});o.template[0]&&(o.template[0].innerHTML="<img src='/images/auctions/segments_"+t+".png' alt='Segment'>")}};var g=function(){var e="as_popup_auction_tutorial_times",t=Number(localStorage.getItem(e)),o="#auction-tutorial-modal",a=new Foundation.Reveal($(o));t>=2||($(document).on("open.zf.reveal",o+"[data-reveal]",function(){t++,localStorage.setItem(e,t)}),a.open(),pushEventPopUp("auction-tutorial-modal"))};e.checkPointsToBid=function(){e.points>e.maxBid||e.points<e.minBid?(e.allowBid=!1,e.bid().allowBid=!1):(e.allowBid=!0,e.bid().allowBid=!0,e.bid().points=e.points)},e.addPointsToBid=function(t){e.points<parseFloat(e.auctionDetail.lastBidPoints)+parseFloat(e.auctionDetail.bidPointsMaxIncrement)&&(e.points+=1,e.bid().points=e.points),dataLayer.push({event:"botones_puja_producto_destacado",event_category:"subastas",event_action:"aumentar puja",event_label:"producto destacado:"+t.title})},e.subsPointsToBid=function(t){e.points>parseFloat(e.auctionDetail.lastBidPoints)&&(e.points-=1,e.bid().points=e.points),dataLayer.push({event:"botones_puja_producto_destacado",event_category:"subastas",event_action:"disminuir puja",event_label:"producto destacado: "+t.title})},e.cancelBid=function(){dataLayer.push({event:"pujar_producto_destacado",event_category:"subastas",event_action:"cancelar puja",event_label:"producto destacado: "+e.bid().title})},e.openBidModal=function(){sessionStorage.getItem("AS_AuctionConfirmModal")?e.doBid():new Foundation.Reveal($("#auction-confirm-modal")).open();pushEventPopUp("confirm")},e.calcPointsVariable=function(){var t=e.bid().points*e.bid().bidPointsCostFee/100;return t<e.bid().bidMinCostFee?e.bid().bidMinCostFee:t},e.clickStickyBid=function(t){e.featuredButton=!0,dataLayer.push({event:"pujar_producto_destacado",event_category:"subastas",event_action:"pujar",event_label:"producto destacado: "+t.title})},e.clickStickyImgBid=function(t){0==e.featuredButton?dataLayer.push({event:"imagen_producto_destacado",event_category:"subastas",event_action:"imagen",event_label:"producto destacado: "+t.title}):e.featuredButton=!1},e.doBid=function(){if(e.bid().loading=!0,n().literalCID){e.bid().loading=!0;var t={literalAuction:e.bid().literalAuction,bidPoints:e.bid().points};e.dontShowAgain&&sessionStorage.setItem("AS_AuctionConfirmModal","true"),o.doBid(t).then(function(o){var a=new Foundation.Reveal($("#auction-confirmed-modal")),i=o.data;void 0!==i.exception?(e.result({ok:!1,ko:!0,title:e.bid().title,message:i.exception.message,code:i.exception.code}),a.open()):"ok"==i.status&&(e.result({ok:!0,ko:!1,title:e.bid().title,message:null,code:null}),e.bid().lastBidder=n().literalCID,e.bid().lastBidderName=n().attributes.nombre+" "+n().attributes.apellido_1[0]+".",e.bid().totalBids=i.totalBids,e.bid().lastBidPoints=parseFloat(t.bidPoints),w(),a.open()),e.bid().loading=!1,dataLayer.push({event:"puja_producto_destacado",event_category:"subastas",event_action:"realizar puja",event_label:"producto destacado:"+e.bid().title})},function(t){e.bid().loading=!1})}else showModalLogin(),void 0!==site.isLogged.literalCID&&e.doBid()},e.updateConsumerData=function(){var t=e.send();t.telefono_1=e.consumer().attributes.telefono_1,a.update(t).then(function(t){return e.loading=!1,e.submitted=!0,new Foundation.Reveal($("#auctionsSendConfirm")).open(),!0},function(e){return e})},e.setAuctionFilters=function(t){t?(e.category=t,e.sticky=null,e.limit=!1,dataLayer.push({event:"categorias_subastas",event_category:"subastas",event_action:"categoría",event_label:t})):(e.category=null,e.sticky=0,e.limit=3,dataLayer.push({event:"ver_subastas_activas",event_category:"subastas",event_action:"clic",event_label:"ver subastas activas"}))},e.notifyMe=function(t){if(n().literalCID){e.activeCountdown=!1;var a={literalAuction:t};o.notify(a).then(function(o){var a=new Foundation.Reveal($("#auction-notify-modal")),n=o.data;void 0!==n.exception?(e.result({ok:!1,ko:!0,title:null,message:n.exception.message,code:n.exception.code}),a.open()):"ok"==n.status&&(e.result({ok:!0,ko:!1,title:null,message:n.message,code:null}),a.open()),e.activeCountdown=!0,dataLayer.push({event:"aviso_proximas_subastas",event_category:"subastas",event_action:"avisadme",event_label:"próximas subastas:"+t})},function(t){e.activeCountdown=!0})}else showModalLogin(),void 0!==site.isLogged.literalCID&&e.notifyMe(t)},e.scrollAnchor=function(e,t){t.preventDefault();var o=$(window),a=o.scrollTop(),n=$(e).position(),i=n.top;if(i)return a?void o.scrollTop(i):void o.scrollTop(i+10)},e.categoryFilter=function(t){return null==e.category?t:e.category==t.category?t:void 0},e.stickyFilter=function(t){return null==e.sticky?t:e.sticky==t.sticky?t:void 0},e.blockLink=function(e,t){1!=e.clicked?e.clicked=!0:t.preventDefault()},e.taggingSticky=function(e){dataLayer.push({event:"pujar_producto_destacado",event_category:"subastas",event_action:"pujar",event_label:e.title})},e.taggingAuction=function(e){dataLayer.push({event:"pujar_subastas_curso",event_category:"subastas",event_action:"pujar",event_label:e.title})},e.taggingAuctionImage=function(e){dataLayer.push({event:"imagen_subastas_curso",event_category:"subastas",event_action:"imagen",event_label:"subastas en curso: "+e.title})},e.taggingSliderClosed=function(e){dataLayer.push({event:"slide_show_subastas_cerradas",event_category:"subastas",event_action:"slide show:"+e.id,event_label:"subastas cerradas"})},e.nextAuctionImgClick=function(e){dataLayer.push({event:"imagen_proximas_subastas",event_category:"subastas",event_action:"imagen",event_label:"próximas subastas:"+e.title})},e.confirmSend=function(){new Foundation.Reveal($("#auctionsSendConfirm")).open(),dataLayer.push({event:"confimar_direccion",event_category:"subastas",event_action:"confirmar",event_label:"Puja ganada"})};var m=function(e){if(!e)return"/";var t=e.split("/");return"es"===t[0]||"ca"===t[0]?(t.splice(0,1),t.join("/")):e},f=function(e){var t=e.h;return e.days&&(t+=24*e.days),t},v=function(e,t){for(var o=0;o<t.length;o++)if(t[o].nid===e.nid)return t[o]=e;return t.push(e)},h=function(e){return void 0!==e.auctionList&&"undefined"!=e.auctionList&&void 0!==site.isLogged.literalCID?e.auctionList:[]},b=function(t){var o={};if(e.stickyAuction.nid&&"existe"===x(e.stickyAuction,e.activeAuctions))for(var a=0;a<e.activeAuctions.length;a++)if(o=e.activeAuctions[a],o.nid===e.stickyAuction.nid)return null!==o.image&&""!=o.image.url&&S(o,s),o.lastBidderName&&""!=o.lastBidderName||(o.lastBidderName="---"),e.activeAuctions.splice(a,1),o;for(var n=0;n<t.length;n++)for(var a=0;a<e.activeAuctions.length;a++)if(o=e.activeAuctions[a],t[n]===o.unixEndDate)return null!==o.image&&""!=o.image.url&&S(o,s),o.lastBidderName&&""!=o.lastBidderName||(o.lastBidderName="---"),e.activeAuctions.splice(a,1),o;return o},y=function(e){var t,o,a,n;return n=Math.floor(e/1e3),a=Math.floor(n/60),n%=60,o=Math.floor(a/60),a%=60,t=Math.floor(o/24),o%=24,{days:t,h:o,i:a,s:n}},D=function(e){i=1e3*e},k=function(e){return e.routeAlias=null,e.finished=!0,e.timeToEndAuctionDate.d=0,e.timeToEndAuctionDate.days=0,e.timeToEndAuctionDate.h=0,e.timeToEndAuctionDate.i=0,e.timeToEndAuctionDate.m=0,e.timeToEndAuctionDate.s=0,e.timeToEndAuctionDate.y=0,e.lastBidPoints=e.lastBidPoints?e.lastBidPoints:e.totalBids,null!==e.image&&""!=e.image.url&&S(e,r),e},C=function(){e.auctionDetail={}},x=function(e,t){for(var o=0;o<t.length;o++)if(t[o].nid===e.nid)return"existe";return e.nid},S=function(e,t){for(var o=0;o<t.length;o++){var a=t[o].sticky;e[t[o].breakpoint]=a?e[a].url.replace("%WIDTH%/%HEIGHT%",t[o].size):e.image.url.replace("%WIDTH%/%HEIGHT%",t[o].size)}},P=function(t,o){void 0===t.countdown&&(t.countdown=setInterval(function(){o.days>0||o.h>0||o.i>0||o.s>1?o.s>0?o.s--:(o.s=59,o.i>0?o.i--:(o.i=59,o.h>0?o.h--:(o.h=23,o.days>0&&o.days--))):0==o.days&&0==o.h&&0==o.i&&1==o.s&&(clearInterval(t.countdown),void 0!==t.callAtCountEnd&&t.callAtCountEnd()),e.$apply()},1e3),e.activeCountdown=!0)},w=function(){a.isLogged().then(function(e){var t=e.data;void 0!==t.literalCID&&a.add(t)},function(e){})},R=function(e){var t=e.split(" "),o=t[0].split("-"),a=t[1].split(":");return new Date(o[2],parseInt(o[1])-1,o[0],a[0],a[1],a[2]).getTime()};void 0!==site.isLogged.literalCID&&void 0!==site.isLogged.literalCID&&(e.logged=a.getLogged()),e.unixStartDate=function(e){return e.unixStartDate},e.unixEndDate=function(e){return e.unixEndDate}}]).filter("zeroFill",function(){return function(e,t){var o=parseInt(e,10),t=parseInt(t,10);if(isNaN(o)||isNaN(t))return e;for(o=""+o;o.length<t;)o="0"+o;return o}}).filter("capitalize",function(){return function(e){return e=e||"",e.toLowerCase().replace(/(?:^|\s)\S/g,function(e){return e.toUpperCase()})}}).filter("comma2decimal",[function(){return function(e){return e?e.toString().trim().replace(",","."):null}}]),controllers.controller("brandsController",["$scope","$sce","$http","$window","Brands",function(e,t,o,a,n){var i=function(e){return(e.indexOf(" ")>=0||e.indexOf("%20")>=0)&&(e=e.split("-").join(" ")),e},r=function(e){return e=e.replace(/\s+/g,"-").toLowerCase().replace("&","and")},s={actimel:{title:"Los productos de Actimel en Danone ツ | Actimel",description:"Descubre con Danone y Danone toda la información sobre los productos de la gama Actimel©. Haz ►clic◄ y encuéntralos"},activia:{title:"Los productos de Activia en Danone ツ | Activia",description:"Descubre con Danone y Danone toda la información sobre los productos de la gama Activia©. Haz ►clic◄ y encuéntralos"},danacol:{title:"Los productos de Danacol en Danone ツ | Danacol",description:"Descubre con Danone y Danone toda la información sobre los productos de la gama Danacol. Haz ►clic◄ y encuéntralos"},danet:{title:"Los productos de Danet en Danone ツ | Danet",description:"Descubre con Danone y Danone toda la información sobre los productos de la gama Danet. Haz ►clic◄ y encuéntralos"},danonino:{title:"Los productos de Danonino en Danone ツ | Danonino",description:"Descubre con Danone y Danone toda la información sobre los productos de la gama Danonino. Haz ►clic◄ y encuéntralos"},danone:{title:"Los productos de Danone en Danone ツ | Yogures Danone",description:"Descubre con Danone y Danone toda la información sobre los productos de la gama Yogures Danone. Haz ►clic◄ y encuéntralos"},densia:{title:"Los productos de Densia en Danone ツ | Densia",description:"Descubre con Danone y Danone toda la información sobre los productos de la gama Densia. Haz ►clic◄ y encuéntralos"},depostre:{title:"Los postres de Danone en Danone ツ | Postres Danone",description:"Descubre con Danone y Danone toda la información sobre los productos de la gama Postres Danone. Haz ►clic◄ y encuéntralos"},"light-&-free":{title:"Los productos de Light & Free en Danone ツ | Light & Free",description:"Descubre con Danone y Danone toda la información sobre los productos de la gama Light & Free. Haz ►clic◄ y encuéntralos"},"mi-primer-danone":{title:"Los productos de Mi Primer Danone en Danone ツ",description:"Descubre con Danone y Danone toda la información sobre los productos de la gama Mi Primer Danone. Haz ►clic◄ y encuéntralos"},oikos:{title:"Los productos de Oikos en Danone ツ | Oikos",description:"Descubre con Danone y Danone toda la información sobre los productos de la gama Oikos. Haz ►clic◄ y encuéntralos"},original:{title:"Los productos originales de Danone ツ | Original Danone",description:"Descubre con Danone y Danone toda la información sobre los productos de la gama Original Danone. Haz ►clic◄ y encuéntralos"},savia:{title:"Los productos de Savia en Danone ツ | Savia",description:"Descubre con Danone y Danone toda la información sobre los productos de la gama Savia. Haz ►clic◄ y encuéntralos"},vitalinea:{title:"Los productos de Vitalinea en Danone ツ | Vitalinea",description:"Descubre con Danone y Danone toda la información sobre los productos de la gama Vitalinea. Haz ►clic◄ y encuéntralos"},"font-vella":{title:"Los productos de Font Vella en Danone ツ | Font Vella",description:"Descubre con Danone y Danone toda la información sobre los productos de la gama Font Vella. Haz ►clic◄ y encuéntralos"},"levité":{title:"Los productos de Levité en Danone ツ | Levité",description:"Descubre con Danone y Danone toda la información sobre los productos de la gama Levité. Haz ►clic◄ y encuéntralos"},"font-vella-sensación":{title:"Los productos de Font Vella Sensación en Danone ツ",description:"Descubre con Danone y Danone toda la información sobre los productos de la gama Font Vella Sensación. Haz ►clic◄ y encuéntralos"},fonter:{title:"Los productos de Fonter en Danone ツ | Fonter",description:"Descubre con Danone y Danone toda la información sobre los productos de la gama Fonter. Haz ►clic◄ y encuéntralos"},"lanjarón":{title:"Los productos de Lanjarón en Danone ツ | Lanjarón",description:"Descubre con Danone y Danone toda la información sobre los productos de la gama Lanjarón. Haz ►clic◄ y encuéntralos"},"font-vella-té":{title:"Los productos de Font Vella Té en Danone ツ",description:"Descubre con Danone y Danone toda la información sobre los productos de la gama Font Vella Té. Haz ►clic◄ y encuéntralos"},"sin-gluten":{title:"Sin gluten | Danone ツ",description:"Conoce las marcas de Danone. Haz clic y conoce toda la linea de productos que Danone tiene para ofrecerte"},"sin-lactosa":{title:"Sin lactosa | Danone ツ",description:"Conoce las marcas de Danone. Haz clic y conoce toda la linea de productos que Danone tiene para ofrecerte"},"sin-grasa":{title:"Sin grasa | Danone ツ",description:"Conoce las marcas de Danone. Haz clic y conoce toda la linea de productos que Danone tiene para ofrecerte"},sabores:{title:"Sabores | Danone ツ",description:"Conoce las marcas de Danone. Haz clic y conoce toda la linea de productos que Danone tiene para ofrecerte"},"para-llevar":{title:"Para llevar | Danone ツ",description:"Conoce las marcas de Danone. Haz clic y conoce toda la linea de productos que Danone tiene para ofrecerte"},"para-beber":{title:"Para beber | Danone ツ",description:"Conoce las marcas de Danone. Haz clic y conoce toda la linea de productos que Danone tiene para ofrecerte"},cremosos:{title:"Cremosos | Danone ツ",description:"Conoce las marcas de Danone. Haz clic y conoce toda la linea de productos que Danone tiene para ofrecerte"},edulcorados:{title:"Edulcorados | Danone ツ",description:"Conoce las marcas de Danone. Haz clic y conoce toda la linea de productos que Danone tiene para ofrecerte"},"con-frutas":{title:"Con frutas | Danone ツ",description:"Conoce las marcas de Danone. Haz clic y conoce toda la linea de productos que Danone tiene para ofrecerte"},naturales:{title:"Naturales | Danone ツ",description:"Conoce las marcas de Danone. Haz clic y conoce toda la linea de productos que Danone tiene para ofrecerte"},"té":{title:"Té | Danone ツ",description:"Conoce las marcas de Danone. Haz clic y conoce toda la linea de productos que Danone tiene para ofrecerte"}};e.skuBrandList=[],e.skuList=[],e.marca=[],e.detail=n.getNid,e.filterValue={sin:null,especialidad:null},e.getUrlContent=n.getUrlContent,e.windowWidth=a.innerWidth,e.initBrands=function(){n.getbrand().then(function(t){var o=t.data;if(e.data=o,o.exception){o.exception.code}else o.skuBrandList.forEach(function(t){e.skuBrandList.push(t)})},function(e){})},e.initList=function(t){n.getList().then(function(t){var o=t.data;if(e.loading=!0,e.data=o,o.exception){o.exception.code}else o.skuList.forEach(function(t){var o=e.skuList;t.ean=t.ean?t.ean:"",o.push(t)}),e.loading=!1}),"filter"!=t&&(e.marca=t)},e.changeFilter=function(t,o){var a=r(t),n="",i="";switch(window.history.replaceState(a,a,a),void 0!==s[a]&&(n=s[a].title,i=s[a].description),document.title=n,void 0!==document.getElementsByTagName("META").title&&(document.getElementsByTagName("META").title.content=n),void 0!==document.getElementsByTagName("META").description&&(document.getElementsByTagName("META").description.content=i),t){case"Sin gluten":e.filterValue[o]="GLUTEN";break;case"Sin lactosa":e.filterValue[o]="LACTOSE";break;case"Sin grasa":e.filterValue[o]="FAT";break;case"Con frutas":e.filterValue[o]="CON FRUTAS";break;case"Para beber":e.filterValue[o]="LÍQUIDOS";break;case"Cremosos":e.filterValue[o]="CREMOSOS";break;case"Desnatados":e.filterValue[o]="DESNATADOS";break;case"Naturales":e.filterValue[o]="NATURAL";break;case"Edulcorados":e.filterValue[o]="EDULCORADOS";break;case"Para llevar":e.filterValue[o]="COMER FUERA";break;case"Sabores":e.filterValue[o]="SABORES";break;case"Té":e.filterValue[o]="TÉ"}e[o]==t?(e[o]=null,e.filterValue[o]=null):e[o]=t},e.checkBrandField=function(t){var o=r(e.marca);r(t)==o&&(e.marca=t)},e.setNid=function(t){n.getDetail(t).then(function(t){var o=t.data;if(e.data=o,o.exception){o.exception.code}else{n.setNid(o);var i=window.location.pathname,r=i.replace(".html","").replace("/es","home").replace("/ca","home").replace("-"," ");document.title;a.dataLayer.push({event:"pop-up",pageName:r+"/"+o.title,auxPageName:r,brand:o.brand})}})},e.filterSku=function(t,o,a){var n=!1,r=-1;if(void 0===e.marca||null==e.marca)n=!0;else{var s=i(e.marca);t.brand.toUpperCase()==s.toUpperCase()&&(n=!0)}return void 0!==e.filterValue.sin&&null!=e.filterValue.sin&&(t.without.some(function(e,t){if(e==this)return r=t,!0},e.filterValue.sin),r<0&&(n=!1)),void 0!==e.filterValue.especialidad&&null!=e.filterValue.especialidad&&(t.feature.some(function(e,t){if(e==this)return r=t,!0},e.filterValue.especialidad),r<0&&(n=!1)),n},e.getBrandContent=function(a){e.brandContent=a,e.language=location.pathname.slice(1,3);var n=a.typeObject[0].urlBody,i=a.typeObject[0].urlJs,r=a.typeObject[0].urlCss,s=a.typeObject[0].urlMBody,c=a.typeObject[0].urlMCss,l=a.typeObject[0].urlMJs;o.get(n).then(function(o){e.bodyHtml=o.data,e.unsafeHtml=t.trustAsHtml(e.bodyHtml)},function(e){}),o.get(i).then(function(t){e.jsFile=t.data},function(e){}),o.get(r).then(function(t){e.cssFile=t.data},function(e){}),o.get(s).then(function(o){e.bodyHtmlM=o.data,e.unsafeHtmlM=t.trustAsHtml(e.bodyHtmlM)},function(e){}),o.get(c).then(function(t){e.cssFileM=t.data},function(e){}),o.get(l).then(function(t){e.jsFileM=t.data},function(e){})},e.controllerTagEvent=function(e){tagEvent(e)}}]),controllers.controller("brandsLandingsController",["$scope","$window","Consumer",function(e,t,o){e.consumer=o.get,e.isLogged=function(){if(void 0===e.consumer().literalCID){var o="http://perf.danone.es/actimelkids";window.open(o,"_blank")}else{var o="http://"+t.location.host+"/ahorra/imprimir-cupones";t.location.href=o}}}]),controllers.controller("cashbackController",["$scope","$rootScope","Cashback","Saving","Consumer","Coupon","FileUploader","$window",function(e,t,o,a,n,i,r,s){e.consumer=n.get;var c=e.consumer().literalCID;e.hasUpload=!1,e.getImages=o.getImages,e.removeImages=o.removeImages,e.filePath=[],e.imageList=[],e.fileNameModal=o.getFilename,e.setStep=o.setStep,e.step=o.getStep,e.uno=1,e.cuponCanje=[],e.couponCanjeTotalList=[],e.imageListCanjeTmp=[],e.basketCashbackCart=!0;var l=[];e.basket=i.getBasket;var u=document.getElementsByName("csrf-token")[0].getAttribute("content"),d=QueryString;e.progress=0,e.zoom=function(e){new Foundation.Reveal($("#refund_zoom")).open(),o.setFilename(e)},e.refundInit=function(){var t=e.uploader=new r({url:"/ajax/cart/addTicketCashbackCart",headers:{"X-CSRF-TOKEN":u}});void 0!=d.ticketId?(e.loading=!0,e.idCanje=d.ticketId,o.setStep(5),a.consumerStatusDetail(c,"refused").then(function(t){var a=t.data;if(a.exception)e.exception=a.exception,e.loading=!1;else{a.canjeList.forEach(function(t){t.idCanje==d.ticketId&&(e.cuponCanje=t)}),e.numCesta=e.cuponCanje.cestaId,e.imageListCanje=e.cuponCanje.ticketCashbackList;e.cuponCanje.couponCashbackList.forEach(function(e){l.push(e.couponId)}),i.detailList(l).then(function(t){var o=t.data;o.exception?(e.couponList.exception=o.exception,e.loading=!0):(l.length>1?angular.forEach(o,function(t){null!=t.variety&&(t.variety=t.variety.replace(/,/g,"<br/>",!0)),e.couponCanjeTotalList.push(t)}):e.couponCanjeTotalList.push(o),e.couponLength=e.couponCanjeTotalList.length,e.pointsArray=[],1==e.couponCanjeTotalList.length?e.couponTotalPoints=e.couponCanjeTotalList[0].pointsValue:(e.couponTotalPoints=0,angular.forEach(e.couponCanjeTotalList,function(t){var o=parseInt(t.pointsValue);e.pointsArray.push(o);for(var a=0;a<e.pointsArray.length;a++)e.couponTotalPoints+=e.pointsArray[a]})),e.loading=!1)})}e.removeCanjeTicket=function(t){var o=e.imageListCanje.indexOf(t);-1!=o&&e.imageListCanje.splice(o,1);var o=e.imageListCanjeTmp.indexOf(t);-1!=o&&(e.imageListCanjeTmp.splice(o,1),e.removeImages(t))},e.addCanjeTicket=function(t){e.imageListCanje.push(t)},e.checkoutCartCashback=function(){e.loading=!0,o.redeemCashbackCart(e.idCanje,e.numCesta).then(function(t){var o=t.data;if(o.exception){if(e.loading=!1,"ILSRV0205"==o.exception.code){var a=new Foundation.Reveal($("#canjeTicketVacio"));a.open(),pushEventPopUp(a.id)}}else{var n=location.pathname.slice(1,3);window.location=location.origin+"/"+n+"/consumer/saving",e.loading=!1}})}})):(void 0!==site.isLogged.literalCID&&a.consumerStatusDetail(c,"refused").then(function(t){var o=t.data;o.exception&&(e.exception=o.exception,e.loading=!1)}),e.checkoutCartCashback=function(){e.consumerTotalPoints=e.consumer().pointsAvailable,e.consumerTotalPoints=e.consumerTotalPoints.replace(",0",""),e.puntosRestantes=(parseFloat(e.consumerTotalPoints.replace(".","").replace(",","."))-e.basket().totalPoints).toFixed(1).toString().replace(".",",").replace(/\B(?=(\d{3})+(?!\d))/g,"."),e.puntosRestantes=e.puntosRestantes.replace(",0","");var t=e.step();if(1==t)t++,o.setStep(t);else if(2==t){e.loading=!0;o.getImageNumber();o.getImages().then(function(a){var n=a.data;e.basket().list.length;if(n.exception)e.exception=n.exception,e.loading=!1;else{e.imageDrop=[],e.imageList=n,e.imageNumber=n.length;for(var i=0;i<e.imageNumber;i++)e.imageDrop.push(n);e.imageNumber<1?($("#boxTutorialModal").foundation("open"),pushEventPopUp("boxTutorialModal")):(t="3",o.setStep(t)),e.loading=!1}})}else e.loading=!0,o.redeemCashbackCart().then(function(a){var n=a.data;n.exception?(e.exception=n.exception,e.loading=!1,"transactionAllowedFalse"==n.exception.code?$("#loginCorreoFinal24").foundation("open"):(dataLayer.push({event:"reembolso",event_category:"reembolsar_cupones_gtm",event_action:"purchase",event_label:"error:"+n.exception.message}),$("#cashback_KO #promoErrorCode").removeClass("hide"),$("#cashback_KO #promoErrorCode #code").text(n.exception.code),Utils.replacePatter("#cashback_KO","%MESSAGE%",n.exception.message),Utils.openModal("#cashback_KO"))):(t="4",o.setStep(t),
void 0!==n.pointsAvailable&&(e.consumer().pointsAvailable=n.pointsAvailable,e.loading=!1),dataLayer.push({event:"reembolso",event_category:"reembolsar_cupones_gtm",event_action:"purchase",event_label:e.imageNumber}))})}),void 0==d.ticketId&&void 0!==site.isLogged.literalCID&&(e.loading=!0,void 0!==site.isLogged.literalCID?e.getImages().then(function(t){var a=t.data;if(a.exception)e.exception=a.exception;else{e.imageList=a;var n=a.length;o.setImageNumber(n),e.imageDrop=[];for(var i=2;i<n;i++)e.imageDrop.push(i);e.loading=!1}}):e.loading=!1),t.filters.push({name:"imageFilter",fn:function(e,t){return-1!=="|jpg|png|jpeg|bmp|gif|".indexOf("|"+e.type.slice(e.type.lastIndexOf("/")+1)+"|")}}),t.filters.push({name:"imageSize",fn:function(e,t){return e.size>=2097152&&($("#cashbackLimitExceeded").foundation("open"),pushEventPopUp("cashbackLimitExceeded")),e.size<=2097152}}),t.onWhenAddingFileFailed=function(e,t,o){},t.onAfterAddingFile=function(o){t.uploadAll(),e.imageDrop.push("New Item")},t.onAfterAddingAll=function(e){},t.onBeforeUploadItem=function(e){},t.onProgressItem=function(e,t){},t.onProgressAll=function(t){e.progress=t},t.onSuccessItem=function(e,t,o,a){},t.onErrorItem=function(e,t,o,a){},t.onCancelItem=function(e,t,o,a){},t.onCompleteItem=function(t,o,a,n){e.progress=0;var i=t._xhr.response;if(e.imageList.push(i),e.imageListCanjeTmp.push(i),void 0!=d.ticketId&&e.imageListCanjeTmp.length>0){e.imageListCanje=[],e.imageDrop=[],e.canjeStart=!0;for(var r=0;r<e.imageListCanjeTmp.length;r++)e.imageDrop.push(r)}},t.onCompleteAll=function(){}},e.removeImages=function(t){e.filePath=t,o.removeImages(t).then(function(o){var a=o.data;if(a.exception)e.exception=a.exception;else{var n=e.imageList.indexOf(t);n>=-1&&(e.imageList.splice(n,1),e.imageDrop.pop())}})},e.goToStep=function(t){t<e.step()&&4!=t&&o.setStep(t)},e.tutorialTag=function(){dataLayer.push({event:"tutorial",event_category:"tutoriales",event_action:"empezar a ahorrar",event_label:"cupones"})}}]),controllers.controller("contentController",["$scope","$window","$sce","Content","Consumer",function($scope,$window,$sce,Content,Consumer){$scope.contentDetail=Content.getDetail,$scope.getAccordion=Content.getAccordion,$scope.contentTags=Content.getTags,$scope.consumer=Consumer.get,$scope.articleTendencias=[],$scope.articleEjercicios=[],$scope.articleMomentosFamilia=[],$scope.articleHogar=[],$scope.recipeComidas=[],$scope.recipeCenas=[],$scope.recipeMeriendas=[],$scope.recipeHealtySnacks=[],$scope.recipeBebidas=[],$scope.articleYogur=[],$scope.articleQueYogur=[],$scope.articleBenefitsYogur=[],$scope.articleDanoneYogur=[],$scope.articleLactosa=[],$scope.articleCompromisoDanone=[],$scope.articleBreakFast=[],$scope.articleBenefitsBreakFast=[],$scope.articleRecipesBreakFast=[],$scope.articleSpecialBreakFast=[],$scope.articleDefensas=[],$scope.articleDigestiva=[],$scope.articleColesterol=[],$scope.articleDieta=[],$scope.articleOseo=[],$scope.articleAgua=[],$scope.recipeDesayunos=[],$scope.recipePostres=[],$scope.articleEmbarazo=[],$scope.articleBebe=[],$scope.articleNinos=[],$scope.articleTrucos=[],$scope.articleRecipe=[],$scope.articleRecipeAll=[],$scope.articleStickyRecipe=[],$scope.articleFamily=[],$scope.articleFamilyAll=[],$scope.articleStickyFamily=[],$scope.articleOrdinary=[],$scope.articleAll=[],$scope.articleSticky=[],$scope.articleTag=[],$scope.isChecked=!1,$scope.isRecipe=!1,$scope.isFamily=!1,$scope.dificultad="",$scope.receta="",$scope.recipeList={},$scope.articleBrand=[],$scope.isYoutubeImg=!1,$scope.loading=!0,$scope.loadVideo=!1,$scope.setTags=function(e,t){var o=$scope.contentTags();o[e]=t,Content.setTags(o)},$scope.articleCapitalLetterLeft=function(){if(void 0!==$scope.articleDetail)return $scope.articleDetail.recipes?{left:"35%"}:{left:"18%"}},$scope.marginTop30=function(){if(window.outerWidth<481)return{"margin-top":"30px"}},$scope.marginTop45=function(){if(window.outerWidth<481)return{"margin-top":"45px"}},$scope.articleCapitalLetter=function(){var e=null;if(void 0!==$scope.articleDetail){e=$scope.articleDetail.description.constructor===Array?$($scope.articleDetail.description[0]).text():$($scope.articleDetail.description).text()}else $("#content-yogur .section-one").each(function(e){0===e&&void 0!==$(this)[0].innerHTML[0]&&$(this).parent().find("span").text($(this)[0].innerHTML[0])});return e[0]},$scope.initSlider=function(){$scope.slickConfigHome={infinite:!1,arrows:!1,dots:!0,slidesToShow:1,slidesToScroll:1,autoplay:!0,autoplaySpeed:5e3}},$scope.slickConfig={infinite:!1,arrows:!1,dots:!0,slidesToShow:1,slidesToScroll:1,autoplay:!0,autoplaySpeed:5e3};var isDesktop=!0;/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)&&(isDesktop=!1),$scope.slickRecipeConfig={infinite:!0,arrows:isDesktop,dots:!0,slidesToShow:1,slidesToScroll:1,autoplay:!0,autoplaySpeed:7e3,speed:500,fade:!0,cssEase:"linear",lazyLoad:"ondemand",lazyLoadBuffer:0},$scope.openSliderVideo=function(e){if($scope.play=!0,e.video){var t=e.video.replace("https://www.youtube.com/watch?v=","https://www.youtube.com/embed/");$scope.urlDestination=$sce.trustAsResourceUrl(t+"?rel=0&autoplay=1")}},$scope.getContentClean=function(e){var t=$(e.target),o="null"!==t.attr("array")?t.attr("array"):null,a="null"!==t.attr("difficult")?t.attr("difficult"):null,n="null"!==t.attr("tags")?t.attr("tags"):null,i="null"!==t.attr("isSticky")?t.attr("isSticky"):null,r="null"!==t.attr("rowcount")?t.attr("rowcount"):null,s="null"!==t.attr("brand")?t.attr("brand"):null,c="true"===t.attr("isMenu");$scope.getContent(o,a,n,i,r,s,c)},$scope.getContent=function(array,difficult,tags,sticky,rowcount,brand,isMenu,priorityMaxValue,priorityTypeOrder){var array=eval(array);if(0===array.length){if(Content.getList(null,difficult,tags,sticky,rowcount,brand,isMenu,priorityMaxValue,priorityTypeOrder).then(function(e){var t=e.data;t.exception?(void 0===$scope.item&&($scope.item={}),$scope.item.exception=t.exception):t.articleList.forEach(function(e){if("0"==e.sticky){if($scope.isYoutubeImg=!1,array.push(e),e.urlVideo){var t=e.urlVideo.replace("https://www.youtube.com/watch?v=","https://www.youtube.com/embed/");$scope.urlDestination=$sce.trustAsResourceUrl(t)}$scope.detailRRSS=e.routeAlias.replace(/es\/|ca\/|pt\//,""),$scope.loading=!1}else{var o=$("#stickyBg");if("Recetas"==e.tags||"Comidas"==e.tags||"Cenas"==e.tags||"Postres"==e.tags||"Bebida"==e.tags||"Meriendas"==e.tags||"Desayunos"==e.tags||"receptes"==e.tags||"dinars"==e.tags||"sopars"==e.tags||"postres"==e.tags||"beguda"==e.tags||"berenars"==e.tags||"esmorzars"==e.tags){$scope.articleStickyRecipe.push(e);var a=$scope.articleStickyRecipe[0].stickyImage.url;new Foundation.Interchange(o,{rules:[" "+a.replace("%WIDTH%","1875").replace("%HEIGHT%","370")+", small "," "+a.replace("%WIDTH%","2500").replace("%HEIGHT%","480")+", medium "," "+a.replace("%WIDTH%","2500").replace("%HEIGHT%","480")+", large "]});$scope.loading=!1}else if("Embarazo"==e.tags||"Bebe"==e.tags||"Ninos"==e.tags||"Ahorro"==e.tags||"embaras"==e.tags||"nado"==e.tags||"nens"==e.tags||"estalvi"==e.tags){$scope.articleStickyFamily.push(e);var n=$scope.articleStickyFamily[0].stickyImage.url;new Foundation.Interchange(o,{rules:[" "+n.replace("%WIDTH%","1875").replace("%HEIGHT%","370")+", small "," "+n.replace("%WIDTH%","2500").replace("%HEIGHT%","480")+", medium "," "+n.replace("%WIDTH%","2500").replace("%HEIGHT%","480")+", large "]});$scope.loading=!1}else{$scope.articleSticky.push(e);var i=$scope.articleSticky[0].stickyImage.url;if(void 0!==i&&null!=i){new Foundation.Interchange(o,{rules:[" "+i.replace("%WIDTH%","1875").replace("%HEIGHT%","370")+", small "," "+i.replace("%WIDTH%","2500").replace("%HEIGHT%","480")+", medium "," "+i.replace("%WIDTH%","2500").replace("%HEIGHT%","480")+", large "]})}$scope.loading=!1}}})}),$scope.busyLoadingData)return;$scope.busyLoadingData=!0}},$scope.windowWidth=$window.innerWidth;var filterSwitch=function(e,t,o){null==t&&(t=["COMIDAS","CENAS","MERIENDAS","POSTRES","BEBIDAS"]),0===t.length?Content.getList(e,o,"0").then(function(e){var o=e.data;o.exception?$scope.item.exception=o.exception:o.articleList.forEach(function(e){t.push(e),$scope.articleRecipe=t})}):$scope.articleRecipe=t},getAllRecipes=function(){0===$scope.articleRecipeAll.length?Content.getList(null,["COMIDAS","CENAS","MERIENDAS","POSTRES","BEBIDA"],"0").then(function(e){var t=e.data;t.exception?$scope.item.exception=t.exception:t.articleList.forEach(function(e){$scope.articleRecipeAll.push(e),$scope.articleRecipe=$scope.articleRecipeAll})}):$scope.articleRecipe=$scope.articleRecipeAll},switchDifficult=function(e,t){switch($scope.difficult){case"Fácil":filterSwitch("EASY_RECIPE",e+"Easy",t);break;case"Media":filterSwitch("MEDIUM_RECIPE",e+"Medium",t);break;case"Difícil":filterSwitch("HARD_RECIPE",e+"Hard",t)}};$scope.filter=function(e,t){switch("receta"==t&&($scope.receta==e&&(e=""),$scope.receta=e),"dificultad"==t&&($scope.dificultad==e&&(e=""),$scope.dificultad=e),$scope.receta){case"Comidas":var o="COMIDAS";break;case"Cenas":var o="CENAS";break;case"Postres":var o="POSTRES";break;case"Bebidas":var o="BEBIDA";break;case"Meriendas":var o="MERIENDAS";break;case"Desayunos":var o="DESAYUNOS";break;default:var o=["COMIDAS","CENAS","MERIENDAS","POSTRES","BEBIDA"]}switch($scope.dificultad){case"Fácil":var a="EASY_RECIPE";break;case"Media":var a="MEDIUM_RECIPE";break;case"Difícil":var a="HARD_RECIPE";break;default:var a=null}var n=null==a?"":a,i=null==o?"":o;void 0===$scope.recipeList[i+n]&&($scope.recipeList[i+n]=[]),filterSwitch(a,$scope.recipeList[i+n],o)},$scope.initDetail=function(e,t,o){$scope.loading=!1,$scope.contentDetail(e,t,o).then(function(e){var t=e.data;if(t.exception)$scope.item.exception=t.exception;else{if($scope.articleDetail=t,$scope.articleDetail.urlVideo){var o=t.urlVideo.replace("https://www.youtube.com/watch?v=","https://www.youtube.com/embed/");$scope.urlDestination=$sce.trustAsResourceUrl(o+"?rel=0&autoplay=1")}$scope.loading=!0}}),$scope.showVideo=function(){$scope.loadVideo=!0}},$scope.getData=function(e){null!=e.brandInfo&&void 0!==e.brandInfo&&($scope.brandInfoLink=e.brandInfo.routeAlias),$scope.articleDetail=e},$scope.getTag=function(e,t,o){},$scope.controllerTagEvent=function(e){tagEvent(e)}}]),controllers.controller("couponController",["$scope","$rootScope","Coupon","Consumer","Cashback","$window",function(e,t,o,a,n,i){function r(t){var o=$.map(t,function(e,t){return[e]}),a={list:o,totalItems:0,totalRefund:0,totalPoints:0};return a.list.forEach(function(e){a.totalItems+=e.qty;var t=parseFloat(e.coupon.discountValue.replace(".","").replace(",",".")),o=parseFloat(e.coupon.pointsValue.replace(".","").replace(",","."));a.totalRefund=a.totalRefund+t*e.qty,a.totalPoints=a.totalPoints+o*e.qty}),a.totalRefundString=a.totalRefund.toFixed(2).toString().replace(".",",").replace(/\B(?=(\d{3})+(?!\d))/g,"."),a.totalPointsString=a.totalPoints,void 0==e.consumer().pointsAvailable&&(e.consumer().pointsAvailable="0,00"),a}function s(t){var o=-1;return e.basket().list.some(function(e,t){if(e.coupon.literalODR==this)return o=t,!0},t.literalODR),t.disabled=!1,t.limit=!1,t.noStock=!1,$("#"+t.literalODR).removeClass("disabled"),0==t.stockAvailable||-1!=o&&t.stockAvailable==e.basket().list[o].qty?($("#"+t.literalODR).addClass("disabled"),t.disabled=!0,t.noStock=!0):(0==t.consumerAvailable||-1!=o&&t.consumerAvailable==e.basket().list[o].qty)&&void 0!==e.consumer().literalCID&&($("#"+t.literalODR).addClass("disabled"),t.disabled=!0,t.limit=!0),t}function c(e){return angular.forEach(e,function(e){e=s(e)}),e}function l(e){var t=document.createElement("iframe");return document.body.appendChild(t),t.contentWindow.document.write(e),setTimeout(function(){Utils.isIE()&&t.contentWindow.document.close(),t.contentWindow.focus(),t.contentWindow.print(),t.contentWindow.close(),document.body.removeChild(t)},250),!1}var u=function(e){var t=new Foundation.Reveal($(e));t.open(),pushEventPopUp(t.id)},d=null;e.couponList=[],e.specialCoupons=[],e.afterUrl=null,e.loading=!1,e.loadingCoupons=!1,e.basket=o.getBasket,e.environment=o.getEnvironment,e.consumer=a.get,e.literalODR=null,e.arrayliteralODRTotal=[],e.step=n.getStep,e.imageNumber=n.getImageNumber,e.submit=!1,e.logIn=!0,e.setBlocked=o.setBlocked,e.getBlocked=o.getBlocked,e.order="title",e.setOrder=function(t){e.order=t};var p={},g=0;e.haveItems=!1,e.slider=!1,e.slickConfig={infinite:!0,arrows:!1,dots:!0,slidesToShow:1,responsive:[{breakpoint:480,settings:"unslick"}]},e.slickConfigHome={infinite:!1,arrows:!1,dots:!0,slidesToShow:4,slidesToScroll:1,autoplay:!0,autoplaySpeed:5e3,responsive:[{breakpoint:480,settings:{slidesToShow:2}},{breakpoint:1020,settings:{slidesToShow:2,slidesToScroll:1}}]},e.couponInit=function(t){void 0!==site.isLogged.literalCID?(e.logIn=!1,e.arrayliteralODRTotal=[],e.updateBasket(t)):(e.updateBasket(t),void 0!==site.isLogged.literalCID&&(e.logIn=!1,g=0,p={},e.arrayliteralODRTotal=[],e.updateBasket(t))),e.logIn=!1,e.getCouponList(t),e.getSpecialList()},e.couponHomeInit=function(t,o){void 0!==site.isLogged.literalCID?(e.arrayliteralODRTotal=[],e.updateBasket(t)):(e.updateBasket(t),void 0!==site.isLogged.literalCID&&void 0!==site.isLogged.literalCID&&(g=0,p={},e.arrayliteralODRTotal=[],e.updateBasket(t))),e.getCouponList(t,o)},e.getCouponList=function(t,a,n){var i=[],r=[],s=[];e.loadingCoupons=!0,e.slickConfigHome.enabled=!1,o.list("coupon",n).then(function(t){var o=t.data;if(o.exception)e.couponList.exception=o.exception;else{if(void 0!==a){e.couponList=o.couponList.slice(0,a);for(var n=[];e.couponList.length>0;)n=e.couponList.splice(0,a),s.push(n)}else{e.couponList=o.couponList;for(var n=[];o.couponList.length>0;)n=o.couponList.splice(0,10),s.push(n)}e.arrayPacks=s,s.forEach(function(e,t,o){e.forEach(function(e,t,o){i.push(e.literalODR),r.push(e.version)}),m(i,r,t,o),i=[],r=[]})}},function(e){}),e.busyLoadingData||(e.busyLoadingData=!0)};var m=function(t,a,n,i){o.detailList(t,a).then(function(t){var o=t.data;o.exception?e.couponList.exception=o.exception:(e.slider=!0,angular.forEach(o,function(t){t.literalODR&&(null!=t.variety&&(t.variety=t.variety.replace(/,/g,"<br/>",!0)),null!=t.webPublishDate&&(t.webPublishDate=t.webPublishDate.replace(/,/g,"<br/>",!0),t.webPublishDate=t.webPublishDate.split(" ")[0]),null!=t.webUnpublishDate&&(t.webUnpublishDate=t.webUnpublishDate.replace(/,/g,"<br/>",!0),t.webUnpublishDate=t.webUnpublishDate.split(" ")[0]),null!=t.commerceExpirationDate&&(t.commerceExpirationDate=t.commerceExpirationDate.replace(/,/g,"<br/>",!0),t.commerceExpirationDate=t.commerceExpirationDate.split(" ")[0]),f(t),void 0===p[t.literalODR]&&(p[t.literalODR]=g,g++),e.arrayliteralODRTotal[p[t.literalODR]]=s(t),e.arrayliteralODRTotal[p[t.literalODR]].moreInfo=!1,e.arrayliteralODRTotal[p[t.literalODR]].moreInfoToggle=function(){e.arrayliteralODRTotal[p[t.literalODR]].moreInfo=!e.arrayliteralODRTotal[p[t.literalODR]].moreInfo},void 0!==site.isLogged.literalCID&&"object"==typeof site.loggedCouponToBasket&&site.loggedCouponToBasket.literalODR==e.arrayliteralODRTotal[p[t.literalODR]].literalODR&&0==e.arrayliteralODRTotal[p[t.literalODR]].disabled&&0==e.arrayliteralODRTotal[p[t.literalODR]].limit&&0==e.arrayliteralODRTotal[p[t.literalODR]].noStock&&(e.addToBasket(site.loggedCouponToBasket),site.loggedCouponToBasket=void 0,localStorage.setItem("site",JSON.stringify(site)),sessionStorage.removeItem("loggedCouponToBasket")))}),n==i.length-1&&(e.slickConfigHome.enabled=!0,e.loadingCoupons=!1,setTimeout(function(){e.scrollToCoupon()},1e3)))})},f=function(e){if(void 0!==e.webUnpublishDate){var t=e.webUnpublishDate,o=t.split(" "),a=o[0].split("-"),n=parseInt(a[1])-1,i=new Date,r=i.getDate()+"-"+(i.getMonth()+1)+"-"+i.getFullYear(),s=r.split("-"),c=parseInt(s[1])-1,l=new Date(a[2],n,a[0]),u=new Date(s[2],c,s[0]),d=Math.round(Math.abs((l.getTime()-u.getTime())/864e5));e.diffDays=d.toString().replace(/\B(?=(\d{3})+(?!\d))/g,".")}else e.diffDays=null};e.scrollToCoupon=function(){if(document.cookie.indexOf("TC_OPTOUT")>-1){var e=location.hash.slice(1);if(e.length>0){var t="#"+e;$("html, body").animate({scrollTop:$(t).offset().top-180},"slow")}}},e.couponazoSlider=!1,e.slickConfigCoupon={infinite:!1,arrows:!1,dots:!0,slidesToShow:1,slidesToScroll:1,autoplay:!0,autoplaySpeed:5e3,currentSlide:0,event:{}},e.initCouponSlider=function(t){""!=t&&(e.literalODR=t,e.getSpecialList())},e.bgCouponSlider=function(e,t){if(void 0!==e&&e.url){return{"background-image":"url("+e.url.replace("%WIDTH%/%HEIGHT%",t)+")"}}},e.getSpecialList=function(){e.loading=!0,e.slickConfigCoupon.enabled=!1,e.couponazoSlider=!1,o.list("special").then(function(t){var a=t.data;if(a.exception);else{var n=[],i=[],r=a.couponList,c=null;e.literalODR&&!e.consumer().literalCID?r.forEach(function(t,o,a){e.literalODR==t.literalODR&&(n.push(t.literalODR),i.push(t.version))}):r.forEach(function(t,o,a){e.literalODR==t.literalODR&&(c=o),n.push(t.literalODR),i.push(t.version)}),o.detailList(n,i).then(function(t){e.loading=!1;var o=t.data;if(e.specialCoupons=[],o.exception)e.specialList.exception=o.exception;else{var a=0,n=1,i=Object.keys(o).length;angular.forEach(o,function(t,o,r){var c=s(t);f(t),null!=c.variety&&(c.variety=c.variety.replace(/,/g,"<br/>",!0)),c.moreInfo=!1,c.right=window.innerWidth*(i-n)+10+"px",c.moreInfoToggle=function(){c.moreInfo=!c.moreInfo},e.specialCoupons.push(c),a++,n++})}},function(){})}},function(e){})},e.coupon={};var v=function(t){o.list("coupon",t).then(function(t){var a=t.data;a.exception?e.couponList.exception=a.exception:0==a.couponList.length?e.isEmpty=!0:(e.isFull=!0,e.updateBasket("print"),e.coupon=a.couponList[Math.floor(Math.random()*a.couponList.length)],o.detail(e.coupon.literalODR,e.coupon.version).then(function(t){var o=e.coupon.literalODR;if(e.coupon=t.data,f(e.coupon[o]),a.exception)return a.exception;angular.forEach(e.coupon,function(t){null!=t.variety&&(t.variety=t.variety.replace(/,/g,"<br/>",!0)),null!=t.webPublishDate&&(t.webPublishDate=t.webPublishDate.replace(/,/g,"<br/>",!0),t.webPublishDate=t.webPublishDate.split(" ")[0]),null!=t.commerceExpirationDate&&(t.commerceExpirationDate=t.commerceExpirationDate.replace(/,/g,"<br/>",!0),t.commerceExpirationDate=t.commerceExpirationDate.split(" ")[0]),e.coupon=t,e.coupon=s(e.coupon),e.coupon.variety=e.coupon.variety.replace(/,/g,"<br/>",!0)}),e.coupon.moreInfoToggle=function(){e.coupon.moreInfo=!e.coupon.moreInfo}},function(e){}))},function(e){})};e.getRandomCoupon=function(t){void 0!==site.isLogged.literalCID?(e.arrayliteralODRTotal=[],v(t.brand)):(v(t.brand),void 0!==site.isLogged.literalCID&&(e.arrayliteralODRTotal=[],v(t.brand)))},e.addToBasketNA=function(t){var o=JSON.parse(atob(t),!0);e.couponHomeInit("print",8),e.addToBasket(o)},e.addToBasket=function(t){if(e.setBlocked(!0),void 0!==site.isLogged.literalCID){var a=parseInt(e.consumer().pointsAvailable.replace(".","")),n=parseInt(t.pointsValue);if(e.basket().totalPoints+n<=a)e.setBlocked(!0),o.check(t.literalODR,d).then(function(o){e.blocked=!1;var a=o.data,n="cashback"==e.environment()?"reembolsar_cupones_gtm":"imprimir_cupones_gtm",r="cashback"==e.environment()?"reembolso":"agregar_cupon";if(a.exception)e.couponData.exception=a.exception,i.dataLayer.push({event:r,event_category:n,event_action:"anadir_cupon",event_label:"error:"+a.exception.message,product_name:t.brand});else if(a.message){switch(a.message){case"limitCouponSame":t=s(t);break;case"noPoints":$("#cupons_noPoints").foundation("open"),pushEventPopUp("cupons_noPoints");break;case"noStock":t=s(t)}i.dataLayer.push({event:r,event_category:n,event_action:"anadir_cupon",event_label:"error:"+a.message,product_name:t.brand})}else{var c=-1;if(e.basket().list.some(function(e,t){if(e.coupon.literalODR==this)return c=t,!0},t.literalODR),null!=e.afterUrl)return location.href=e.afterUrl,null;e.setBlocked(!1),c>=0?e.basket().list[c].qty++:(e.basket().list.push({coupon:t,qty:1}),e.basketRemainingDays=t.remainingDays);var l=parseFloat(t.discountValue.replace(".","").replace(",",".")),u=parseFloat(t.pointsValue.replace(".","").replace(",","."));e.basket().totalRefund+=l,e.basket().totalRefundString=e.basket().totalRefund.toFixed(2).toString().replace(".",",").replace(/\B(?=(\d{3})+(?!\d))/g,"."),e.basket().totalPoints+=u,e.basket().totalPointsString=e.basket().totalPoints,e.basket().totalItems++,t=s(t),e.arrayliteralODRTotal[p[t.literalODR]]=t,i.dataLayer.push({event:r,event_category:n,event_action:"anadir_cupon",event_label:t.title,product_name:t.brand})}e.loading=!1},function(t){e.loading=!1});else{var r=new Foundation.Reveal($("#cupons_noPoints"));r.open(),pushEventPopUp(r.id)}}else e.$watch("$scope.consumer().literalCID",function(o){void 0!==o&&o==e.consumer().literalCID?e.addToBasket(t):(etiquetado("userManagement","login","acceso","cupones"),showModalLogin(),void 0!=t&&$("#loginFormulario .btn-sendform").data("coupon",t),pushEventPopUp("loginModal"),e.setBlocked(!1))});"/"!==url&&"/ca"!==url&&"/es"!==url&&"/pt"!==url&&void 0!==site.isLogged.status&&"SI"!=String(site.isLogged.attributes.publicidad_GDPR).toUpperCase()&&$("#GDPR").foundation("open")},e.addItem=function(t){var o=t.coupon;e.addToBasket(o),e.arrayliteralODRTotal=c(e.arrayliteralODRTotal)},e.removeItem=function(t){e.setBlocked(!0),o.remove(t.coupon.literalODR,d).then(function(o){e.setBlocked(!1);var a=o.data,n="cashback"==e.environment()?"reembolsar_cupones_gtm":"imprimir_cupones_gtm",r="cashback"==e.environment()?"reembolso":"eliminar_cupon";if(a.exception)e.item.exception=a.exception,i.dataLayer.push({event:r,event_category:n,event_action:"eliminar_cupon",event_label:"error:"+a.exception.message,product_name:a.brand});else{if(t.coupon.couponLimit=!1,0==--t.qty){var c=-1;e.basket().list.some(function(e,t){if(e.coupon.literalODR==this)return c=t,!0},t.coupon.literalODR),e.basket().list.splice(c,1)}var l=parseFloat(t.coupon.discountValue.replace(".","").replace(",",".")),u=parseFloat(t.coupon.pointsValue.replace(".","").replace(",","."));e.basket().totalRefund-=l,e.basket().totalRefundString=e.basket().totalRefund.toFixed(2).toString().replace(".",",").replace(/\B(?=(\d{3})+(?!\d))/g,"."),e.basket().totalPoints-=u,e.basket().totalPointsString=e.basket().totalPoints,e.basket().totalItems--,t.coupon=s(t.coupon),e.arrayliteralODRTotal[[p[t.coupon.literalODR]]]=t.coupon,i.dataLayer.push({event:r,event_category:n,event_action:"eliminar_cupon",event_label:t.coupon.title,product_name:t.coupon.brand})}})},e.removeFromBasket=function(t){o.delete(t.coupon.literalODR,d).then(function(o){var a=o.data,n="cashback"==e.environment()?"reembolsar_cupones_gtm":"imprimir_cupones_gtm",r="cashback"==e.environment()?"reembolso":"eliminar_cupones";if(a.exception)e.item.exception=a.exception;else{var c=parseFloat(t.coupon.discountValue.replace(".","").replace(",",".")),l=parseFloat(t.coupon.pointsValue.replace(".","").replace(",","."));e.basket().totalRefund-=c*t.qty,e.basket().totalRefundString=e.basket().totalRefund.toFixed(2).toString().replace(".",",").replace(/\B(?=(\d{3})+(?!\d))/g,"."),e.basket().totalPoints-=l*t.qty,e.basket().totalPointsString=e.basket().totalPoints,e.basket().totalItems-=t.qty;var u=-1;e.basket().list.some(function(e,t){if(e.coupon.literalODR==this)return u=t,!0},t.coupon.literalODR),e.basket().list.splice(u,1),t.coupon=s(t.coupon),e.arrayliteralODRTotal[p[t.coupon.literalODR]]=t.coupon,i.dataLayer.push({event:r,event_category:n,event_action:"eliminar_cupones",event_label:t.coupon.title,product_name:t.coupon.brand})}})},e.updateBasket=function(t){null==d&&(d=t),e.consumer().literalCID?o.recover(d).then(function(t){var a=t.data;a.exception?e.items.exception=a.exception:o.setBasket(r(a),d)}):o.setBasket(r(null),d)},e.checkoutCart=function(){if("print"==d){$("#coupoModal").foundation("open"),pushEventPopUp("coupoModal");var t=[];e.basket().list.forEach(function(e){for(var o=0;o<e.qty;o++)t.push(e.coupon.title)})}else{var o=e.step();1==o?(o++,n.setStep(o)):2==o&&e.imageNumber()<1&&($("#boxTutorialModal").foundation("open"),pushEventPopUp("boxTutorialModal"))}},e.print=function(t){var a={redemptionType:t},n=[];e.basket().list.forEach(function(e){n.push(e.coupon.title)}),e.submit=!0,"false"==typeof e.consumer().transactionAllowed?u("#loginCorreoFinal24"):o.redeem(a).then(function(o){var a=o.data;void 0!==a.exception?("transactionAllowedFalse"==a.exception.code?$("#loginCorreoFinal24").foundation("open"):($("#htmlCouponFeedbackKO #promoErrorCode").removeClass("hide"),$("#htmlCouponFeedbackKO #promoErrorCode #code").text(a.exception.code),Utils.replacePatter("#htmlCouponFeedbackKO","%MESSAGE%",a.exception.message),Utils.openModal("#htmlCouponFeedbackKO")),e.submit=!1):("HTML"===t&&(l(a.couponHTML),$("#htmlCouponFeedback").foundation("open"),pushEventPopUp("htmlCouponFeedback")),"MAIL"===t&&($("#emailCouponFeedback").foundation("open"),pushEventPopUp("emailCouponFeedback")),void 0!==a.pointsAvailable&&(e.consumer().pointsAvailable=a.pointsAvailable),e.updateBasket(d),$("#coupoModal").foundation("close"),e.submit=!1)},function(e){var t=e.data;$("#htmlCouponFeedbackKO #promoErrorCode").removeClass("hide"),$("#htmlCouponFeedbackKO #promoErrorCode #code").text(t.exception.code),Utils.replacePatter("#htmlCouponFeedbackKO","%MESSAGE%",t.exception.message),Utils.openModal("#htmlCouponFeedbackKO")})},e.setAfterUrl=function(t){e.afterUrl=t},$("#coupoModal").on("closed.zf.reveal",function(){c(e.couponList)})}]),controllers.controller("gigyaController",["$scope","$rootScope","Consumer","$window",function(e,t,o,a){e.initGigya=function(){gigya.socialize.showLoginUI({version:2,showTermsLink:"false",containerID:"gigya-container",width:"300px",height:"50px",buttonsStyle:"fullLogoColored",autoDetectUserProviders:"",facepilePosition:"none",onLoad:function(){$(".loginModal-sociallogin-facebook").off("click").on("click",function(){return $("span[data-gigya-provider='facebook']").click(),!1}),$(".loginModal-sociallogin-gplus").off("click").on("click",function(){return $("span[data-gigya-provider='googleplus']").click(),!1})}}),gigya.socialize.addEventHandlers({context:{str:"AS Bux"},onLogin:n})};var n=function(n){o.checkUpdateCid({user:btoa(JSON.stringify(n.user))}).then(function(i){var r=i.data;if(e.modal_loading=!0,!1===r)t.$emit("refreshGigyaRegisterUserFields",n.user),$("a[data-open='loginRegistro']").click();else if(void 0===r.exception){o.add(r),$(".loginModal").foundation("close");var s="login completado: "+n.provider;a.dataLayer.push({event:"login",event_category:"login",event_action:"login portal",event_label:s})}else{e.exception=r.exception;var s="login incorrecto:"+r.exception.message;a.dataLayer.push({event:"login",event_category:"login",event_action:"login portal",event_label:s})}e.modal_loading=!1})}}]),controllers.controller("loginController",["$scope","$rootScope","Consumer","$window","ChangePassword","vcRecaptchaService",function(e,t,o,a,n,i){e.loginData={},e.required=!0,e.modal_loading=!1,e.consumer=o.get,e.loginData.expireOnClose=!1,e.getLoading=o.getLoading,o.setLoading("false"),e.getLiteralCid=function(t){e.literalCID=t,""==e.literalCID&&$(document).ready(function(){r("#changePasswordFail4")})},e.getLanguage=function(){e.language=location.pathname.slice(1,3)};var r=function(e){var t=new Foundation.Reveal($(e));t.open(),pushEventPopUp(t.id)};e.captcha=0;var s=function(){e.loginData={},e.loginData.expireOnClose=!1,$("fieldset").removeClass("errorFieldset"),$("#formulario form input").each(function(e,t){"sexo"!=$(t).attr("name")&&"submit"!=$(t).attr("type")&&$(t).val("")});var t=document.getElementById("captchaInput");"undefined"==t&&void 0==t||($("#loginFormulario .button-login").attr("disabled","disabled"),1==e.captcha&&i.reload(e.widgetId))};e.setWidgetId=function(t){e.widgetId=t,e.captcha=1},e.cbExpiration=function(){i.reload(e.widgetId),e.response=null},e.setResponse=function(e){$("#formulario .button-login").removeAttr("disabled")},$("#loginModal").on("closed.zf.reveal",function(){s()}),e.toggleCheckBox=function(){e.loginData.expireOnClose=!e.loginData.expireOnClose},e.reportIsFacebook=function(){document.getElementById("socialLoginProvider1").value="facebook",$(".loginModal-socialregister.to-hide").hide(),$(".input-to-hide").hide(),$(".facebook-social-message").show(),$(".google-timer-message").hide(),$(".hide-always").hide(),e.loginData.socialLoginProvider="facebook"},e.reportIsGoogle=function(){$(".input-to-hide").hide(),document.getElementById("socialLoginProvider1").value="google",$(".loginModal-socialregister.to-hide").hide(),$(".facebook-timer-message").hide(),$(".input-to-hide").hide(),$(".google-social-message").show(),$(".hide-always").hide(),e.loginData.socialLoginProvider="google"},e.getData=function(t){void 0!==t&&null!=t&&t.type&&-1!=t.type.indexOf("PROMO")&&(e.loginData.nid=t.nid)},e.consumerLogin=function(){e.modal_loading=!0,e.loginData.checkCaptcha=!1,$("#captchaInput").length>0&&(e.loginData.checkCaptcha=!0),o.login(e.loginData).then(function(t){var n,i=t.data;if(i.exception){"CAPTCHA"!=i.exception.code&&(e.exception=i.exception);var r="login incorrecto:"+i.exception.message;n="ko:"+i.exception.message,s(),e.loading=!1,e.modal_loading=!1}else{site.isLogged=i,site.loggedToOpenPromo=!1,site.loggedCouponToBasket=void 0,site.loggedPincodeSumarPuntos=void 0,site.loggedWuaki=void 0,site.loggedProduct=void 0,site.loggedOriginales=void 0,site.loggedRecipebook=!1,1==$("#loginFormulario .btn-sendform").attr("data-participar")||"true"==$("#loginFormulario .btn-sendform").attr("data-participar")?site.loggedToOpenPromo=!0:"object"==typeof $("#loginFormulario .btn-sendform").data("coupon")?site.loggedCouponToBasket=$("#loginFormulario .btn-sendform").data("coupon"):void 0!==$("#loginFormulario .btn-sendform").attr("data-pincode")?site.loggedPincodeSumarPuntos=$("#loginFormulario .btn-sendform").attr("data-pincode"):void 0!==$("#loginFormulario .btn-sendform").attr("data-wuaki")?site.loggedWuaki=$("#loginFormulario .btn-sendform").attr("data-wuaki"):"object"==typeof $("#loginFormulario .btn-sendform").data("product")?site.loggedProduct=$("#loginFormulario .btn-sendform").data("product"):"object"==typeof $("#loginFormulario .btn-sendform").data("originales")?site.loggedOriginales=$("#loginFormulario .btn-sendform").data("originales"):1!=$("#loginFormulario .btn-sendform").attr("data-recipebook")&&"true"!=$("#loginFormulario .btn-sendform").attr("data-recipebook")||(site.loggedRecipebook=!0),localStorage.setItem("site",JSON.stringify(site)),localStorage.setItem("EDPS-DANES_notificationList",JSON.stringify(i.notificationList)),localStorage.setItem("EDPS-DANES_segmentConsumerList",JSON.stringify(i.segmentsConsumer)),o.add(i);var r="login completado:correo";n="ok",void 0!=$("#loginFormulario .btn-sendform").attr("data-redirect")?window.location.href=$("#loginFormulario .btn-sendform").attr("data-redirect"):a.location.reload()}a.dataLayer.push({event:"login",event_category:"login",event_action:"login portal",event_label:r}),a.dataLayer.push({event:"userManagement",userManagementCategory:"login",userManagementAction:"email",userManagementLabel:n}),e.workerWebPush(i.literalCID,"login")},function(e){})},e.forgotPassword=function(){var e=new Foundation.Reveal($("#loginRegistroNew"));e.open(),pushEventPopUp(e.id),showModalForgottenPassword()},e.recoverPassword=function(t){void 0==t&&void 0!=site.isLogged.status&&(t=site.isLogged.email),e.errorCode=o.getErrorPassword,o.restorePassword(t).then(function(e){var t=e.data;if(t.exception){var o=new Foundation.Reveal($("#recover-password-ko"));o.open(),pushEventPopUp(o.id);var n="recuperar contraseña ko: "+t.exception.code;etiquetado("userManagement","recuperar contrasenia","enviar email","ko:"+t.exception.code)}else{var o=new Foundation.Reveal($("#recover-password-ok")),n="recuperar contraseña ok";o.open(),pushEventPopUp(o.id),etiquetado("userManagement","recuperar contrasenia","enviar email","ok")}a.dataLayer.push({event:"password",event_category:"login",event_action:"login_popup",event_label:n})})},e.changePassword=function(t){e.modal_loading=!0;var o={
password:t.password.$modelValue,literalCID:t.literalCID.$modelValue};""!=t.literalCID.$modelValue?t.password.$modelValue!=t.passwordRepeat.$modelValue?(e.modal_loading=!1,e.password="",e.passwordRepeat="",r("#changePasswordFail1"),etiquetado("userManagement","recuperar contrasenia","establecer tu constrasenia","ko:Las contraseñas introducidas no coinciden. Introdúcelas de nuevo asegurándote que son exactamente iguales y que contienen como mínimo 8 caracteres, una minúscula, una mayúscula y un número.")):t.password.$modelValue.length<8?(e.modal_loading=!1,e.password="",e.passwordRepeat="",r("#changePasswordFail2"),etiquetado("userManagement","recuperar contrasenia","establecer tu constrasenia","ko:La contraseña debe contener al menos 8 caracteres, una minúscula, una mayúscula y un número.")):n.submitFormChangePass(o).then(function(t){e.modal_loading=!1;var o=t.data;if(e.data=o,o.exception){switch(o.exception.code){case"ILREG0299":e.password="",e.passwordRepeat="",r("#changePasswordFail2"),etiquetado("userManagement","recuperar contrasenia","establecer tu constrasenia","ko:"+o.exception.message);break;case"ILREG0301":e.password="",e.passwordRepeat="",r("#changePasswordFail3"),etiquetado("userManagement","recuperar contrasenia","establecer tu constrasenia","ko:"+o.exception.message);break;default:e.password="",e.passwordRepeat="",r("#changePasswordFail2"),etiquetado("userManagement","recuperar contrasenia","establecer tu constrasenia","ko:La contraseña debe contener al menos 8 caracteres, una minúscula, una mayúscula y un número.")}}else e.modal_loading=!1,e.password="",e.passwordRepeat="",r("#changePasswordOK"),$("#changePasswordOK").bind("closed.zf.reveal",function(e){var t="http://"+a.location.host;a.location.href=t}),etiquetado("userManagement","recuperar contrasenia","establecer tu constrasenia","ok")},function(t){e.modal_loading=!1,r("#changePasswordFail3"),etiquetado("userManagement","recuperar contrasenia","establecer tu constrasenia","ko:La contraseña debe contener al menos 8 caracteres, una minúscula, una mayúscula y un número.")}):(e.modal_loading=!1,r("#changePasswordFail4"),etiquetado("userManagement","recuperar contrasenia","establecer tu constrasenia","ko:El link de reinicio de contraseña que has introducido no es correcto, ha caducado o ya ha sido utilizado. <br/> Inténtalo de nuevo."))}}]),controllers.controller("productController",["$scope","$rootScope","Product","Consumer",function(e,t,o,a){function n(e){var t={list:e.list,totalItems:0,totalRefund:0,totalRefundString:"0,00",totalPoints:e.totalPoints,totalPointsString:e.totalPointsString,totalPrice:e.totalPrice,totalPriceString:e.totalPriceString,totalCost:e.totalCost,totalCostString:parseFloat(e.totalCost).toFixed(2).toString().replace(".",",").replace(/\B(?=(\d{3})+(?!\d))/g,"."),totalShippingCost:e.totalShippingCost,totalShippingCostString:e.totalShippingCostString,totalShippingDiscount:e.totalShippingDiscount,totalShippingDiscountString:e.totalShippingDiscountString};return t.list.forEach(function(e,o){t.totalItems+=e.qty,t.totalRefund+=parseFloat(e.product.recommendedPVPPriceODR-e.product.costODR)}),t}function i(t){var o=-1;return e.basket().list.some(function(e,t){if(e.product.literalODR==this)return o=t,!0},t.literalODR),t.disabled=!1,t.limit=!1,t.noStock=!1,t.consumerAvailable,(0==t.consumerAvailable||-1!=o&&t.consumerAvailable==e.basket().list[o].qty)&&void 0!==e.consumer().literalCID?(t.disabled=!0,t.limit=!0):(0==t.stockAvailable||-1!=o&&t.stockAvailable==e.basket().list[o].qty)&&(t.disabled=!0,t.noStock=!0),t}function r(e,t){return t=void 0!==t?t:"",{name:e.title,id:e.literalODR,price:e.costODR,brand:e.brandImage.alt,category:e.productType[0].name,variant:"",list:e.productType[0].name,position:t}}function s(t,o){var a={id:t.cartNumber,affiliation:"online store",revenue:t.totalPrice,tax:"",shipping:t.shippingPrice,coupon:""},n=[];e.basket().list.forEach(function(e,t){var o={name:e.product.title,id:e.product.literalODR,price:e.product.costODR,brand:e.product.brandImage.alt,category:e.product.productType[0].name,variant:"",quantity:e.qty};n[t]=o}),d=e.basket().list;var i={};"pago_reembolso"==o&&(i.event="purchase_contrareembolso"),i.ecommerce={purchase:{actionField:a,products:n}},dataLayer.push(i)}function c(t,o){var a={};a.step=t,o&&(a.option=o);var n=[];e.basket().list.forEach(function(e,t){var o={name:e.product.title,id:e.product.literalODR,price:e.product.costODR,brand:e.product.brandImage.alt,category:e.product.productType[0].name,variant:"",quantity:e.qty};n[t]=o}),d=e.basket().list,dataLayer.push({event:"checkout",ecommerce:{checkout:{actionField:a,products:n}}})}e.basket=o.getBasket,e.consumer=a.get,e.setProduct=o.setProduct,e.getProduct=o.getProduct,e.urlFirstTime=0,e.product=[],e.productList=[],e.arrayTotalProducts=[],e.slider=!1,e.loading=!0,e.seccion=null,e.secciones=o.secciones,e.tipologias=o.tipologias,e.items={},e.costODRMax=0,e.costODRMin=0,e.pointsMax=100,e.pointsMin=100,e.checkAvailbleButtonValue=!0,e.stickyProducts=[],e.checkoutComments="",e.contraReembolso=!1,e.goToTpv=!1,e.arrayTid=[],e.counter=0,e.send={};var l=window.location.pathname.split("/"),u=0,d="";e.slider=!1,e.loading=!1,e.slickConfigHome={infinite:!1,arrows:!1,dots:!0,slidesToShow:4,slidesToScroll:1,autoplay:!0,autoplaySpeed:5e3,responsive:[{breakpoint:480,settings:{slidesToShow:2}},{breakpoint:1020,settings:{slidesToShow:2,slidesToScroll:1}}]},e.slickConfigProducts={dots:!0,infinite:!0,autoplay:!1,speed:500,arrows:!1},e.redeemProduct=function(t){e.setProduct(t),dataLayer.push({event:"productClick",ecommerce:{click:{actionField:{list:t.productType[0].name},products:[{name:t.title,id:t.literalODR,price:t.costODR,brand:t.brandImage.alt,category:t.productType[0].name,variant:""}]}}})},e.getSticky=function(t){e.getProductList(null,t)},e.productHomeInit=function(t,o){void 0!==site.isLogged.literalCID?e.getProductList(null,null,8):(e.getProductList(null,null,8),void 0!==site.isLogged.literalCID&&void 0!==site.isLogged.literalCID&&e.getProductList(null,null,8))},e.getProductList=function(t,a,n){var i=[],r=[],s=[];e.loading=!0,!function(t,o){return e.arrayTid.indexOf(t)>-1}(t,e.arrayTid)?o.getList(t,a,n).then(function(o){var a=o.data;if(a.exception)e.exception=a.exception,e.loading=!1;else{if(e.productList=a.productList,e.productList.forEach(function(t,o,a){e.productList[o].literalODR,e.productList[o].version}),void 0!==n){e.productList=a.productList.slice(0,n);for(var c=[];e.productList.length>0;)c=e.productList.splice(0,n),s.push(c)}else{e.productList=a.productList;for(var c=[];a.productList.length>0;)c=a.productList.splice(0,10),s.push(c);e.arrayTid.push(t)}s.forEach(function(t,o,a){e.counter++,t.forEach(function(e,t,o){i.push(e.literalODR),r.push(e.version)}),v(i,r,o,a),i=[],r=[]}),e.productList.forEach(function(t,o,a){e.productList[o].literalODR,e.productList[o].version})}},function(t){e.loading=!1}):e.loading=!1,e.busyLoadingData||(e.busyLoadingData=!0)};var p=[],g={ecommerce:{currencyCode:"eur",impressions:[]}},m=(g.ecommerce.impressions,[]),f=0,v=function(t,a,n,i){o.detailList(t,a).then(function(t){var o=t.data;if(o.exception)e.exception=o.exception;else{if(0==e.stickyProducts.length)if(void 0!==o.literalODR&&(o={},o[t.data.literalODR]=t.data),3==l.length)e.bgCouponSlider=function(e,t){if(void 0!==e&&e.url){return{"background-image":"url("+e.url.replace("%WIDTH%/%HEIGHT%",t)+")"}}},angular.forEach(o,function(t){e.stickyProducts.push(t),e.slider});else{if(o.literalODR){var a=$.extend({},o);o={},o.literalODR=a}angular.forEach(o,function(t,o,a){if(f++,void 0===t.exception&&t.title.length>40&&(t.title=t.title.substring(0,40)+"..."),t.indexCount=f,e.slider=!0,window.location.hash){if(void 0===p[t.literalODR]){var n=window.location.hash,i=n.replace("#/","");if(i==t.literalODR&&0==e.urlFirstTime){e.setProduct(t);var s=new Foundation.Reveal($("#urlPopup"));s.open(),e.arrayTotalProducts.push(t),e.urlFirstTime=1,p[t.literalODR]=!0}else e.arrayTotalProducts.push(t),e.slider=!0,m.push(r(t,f)),p[t.literalODR]=!0}}else void 0===p[t.literalODR]&&(e.arrayTotalProducts.push(t),m.push(r(t,f)),p[t.literalODR]=!0),e.slider=!0}),n==i.length-1&&(e.loading=!1)}else{if(o.literalODR){var a=$.extend({},o);o={},o.literalODR=a}angular.forEach(o,function(t,o){if(f++,e.slider=!0,window.location.hash){if(void 0===p[t.literalODR]){var a=window.location.hash,n=a.replace("#/","");if(n==t.literalODR&&0==e.urlFirstTime){e.setProduct(t);var i=new Foundation.Reveal($("#urlPopup"));i.open(),e.arrayTotalProducts.push(t),e.urlFirstTime=1,p[t.literalODR]=!0}else e.arrayTotalProducts.push(t),e.slider=!0,p[t.literalODR]=!0,m.push(r(t,f))}}else void 0===p[t.literalODR]&&(e.arrayTotalProducts.push(t),m.push(r(t,f)),p[t.literalODR]=!0),e.slider=!0}),n==i.length-1&&(e.loading=!1)}e.bgCouponSlider=function(e,t){if(void 0!==e&&e.url){return{"background-image":"url("+e.url.replace("%WIDTH%/%HEIGHT%",t)+")"}}}}0===--e.counter&&(dataLayer.push({ecommerce:{currencyCode:"eur",impressions:m}}),$(document).trigger("ecommerce_load"))},function(t){e.loading=!1})};e.seccionFilter=function(t){e.seccion=e.seccion===t.tid?null:t.tid,e.seccion&&(null!=t.productTypeChild?(e.getProductList(t.tid),e.tipologias(t.productTypeChild)):null==t.productTypeChild&&(e.tipologias([]),e.getProductList(t.tid)))},e.tipologiaFilter=function(t){e.tipologia=e.tipologia===t.tid?null:t.tid},e.filterProducts=function(t,o,a){var n=!1;if(e.seccion){var i=e.tipologia?e.tipologia:e.seccion,r=-1;void 0!==t.productType&&t.productType.some(function(e,t){if(e.tid==this)return r=t,!0},i),n=r>=0}else n=!0;return n=!(t.costODR<e.costODRMin&&t.costODR>e.costODRMax)&&n,n=!(t.points<e.pointsMin&&t.points>e.pointsMax)&&n},e.addToBasket=function(t,a){if(void 0!==site.isLogged.literalCID){var n=parseInt(e.consumer().pointsAvailable.replace(".","")),r=parseInt(t.points);if(e.blocked=!0,e.blockedIWantItBtn=!1,void 0===e.basket().totalPoints&&(e.basket().totalPoints=0),Math.round(e.basket().totalPoints)+r<=n){for(var s=new Array,c=0;c<a;c++)s.push(t.literalODR);o.add(s).then(function(o){e.blocked=!1;var a=o.data;if(a.exception)e.product.exception=a.exception,"ILSCO0068"!=a.exception.code&&"ILSCO0070"!=a.exception.code||(e.blockedIWantItBtn=!0);else if(a.message)switch(a.message){case"limitProductSame":t=i(t);break;case"limitODRAvailableOfConsumer":e.checkAvailbleButtonValue=!1;break;case"noPoints":var n=new Foundation.Reveal($("#cupons_noPoints"));n.open(),pushEventPopUp(n.id);break;case"limitODRSame":var n=new Foundation.Reveal($("#limitODRSame"));n.open(),pushEventPopUp(n.id);break;case"noStock":t=i(t);var n=new Foundation.Reveal($("#product_noStock"));n.open(),pushEventPopUp(n.id)}else{var r=-1;if(e.basket().list.some(function(e,t){if(e.product.literalODR==this)return r=t,!0},t.literalODR),null!=e.afterUrl&&(location.href=e.afterUrl),r>=0){e.basket().list[r].qty=a.list[t.literalODR].qty;var s=e.basket().list[r].qty}else{e.basket().list.push({product:t,qty:a.list[t.literalODR].qty});var s=1}e.basket().totalRefund+=parseFloat(t.recommendedPVPPriceODR-t.costODR),e.basket().totalRefundString=e.basket().totalRefund.toFixed(2).toString().replace(".",",").replace(/\B(?=(\d{3})+(?!\d))/g,"."),e.basket().totalPoints=a.totalPoints,e.basket().totalPointsString=a.totalPointsString,e.basket().totalPrice=a.totalPrice,e.basket().totalPriceString=a.totalPriceString,e.basket().totalShippingCost=a.shippingPrice,e.basket().totalShippingCostString=a.shippingPriceString,e.basket().totalShippingDiscount=a.discountPrice,e.basket().totalShippingDiscountString=a.discountPriceString,e.basket().totalCostString=parseFloat(e.basket().totalCost).toFixed(2).toString().replace(".",",").replace(/\B(?=(\d{3})+(?!\d))/g,"."),e.basket().totalItems=0;for(var c in a.list)e.basket().totalItems+=a.list[c].qty;t=i(t),dataLayer.push({event:"addToCart",ecommerce:{currencyCode:"eur",add:{products:[{name:t.title,id:t.literalODR,price:t.costODR,brand:t.brandImage.alt,category:t.productType[0].name,variant:"",quantity:s}]}}})}e.loading=!1},function(e){})}else{var l=new Foundation.Reveal($("#cupons_noPoints"));l.open(),pushEventPopUp(l.id),e.loading=!1}}else e.$watch("consumer().literalCID",function(o){void 0!==o&&o==e.consumer().literalCID?e.addToBasket(t):(etiquetado("userManagement","login","acceso","catalogo"),showModalLogin(),$("#loginFormulario .btn-sendform").data("originales",{product:t,qty:a}),pushEventPopUp("loginModal"))});void 0!==site.isLogged.status&&"SI"!=String(site.isLogged.attributes.publicidad_GDPR).toUpperCase()&&$("#GDPR").foundation("open")},e.checkAvailbleButton=function(e,t){if(null!=e&&!t){var o=e.product.numODRDisponiblesConsumidor,a=e.product.numODRMaxSimultaniously;return parseInt(1!==o)&&(-1===o||o>e.qty||a===e.qty||-1===a)}return!1},e.addItem=function(t){var o=parseInt(e.consumer().pointsAvailable.replace(".","")),a=parseInt(t.product.points);if(e.basket().totalPoints+a<=o){var n=t.product;e.addToBasket(n,1)}else{var i=new Foundation.Reveal($("#cupons_noPoints"));i.open(),pushEventPopUp(i.id),e.loading=!1}},e.removeItem=function(t){e.blocked=!0,o.remove(t.product.literalODR).then(function(o){var a=o.data;if(e.blocked=!1,a.exception)e.item.exception=a.exception;else{if(t.product.productLimit=!1,t.qty--,dataLayer.push({event:"removeFromCart",ecommerce:{remove:{products:[{name:t.product.title,id:t.product.literalODR,price:t.product.costODR,brand:t.product.brandImage.alt,category:t.product.productType[0].name,variant:"",quantity:1}]}}}),0==t.qty){var n=-1;e.basket().list.some(function(e,t){if(e.product.literalODR==this)return n=t,!0},t.product.literalODR),e.basket().list.splice(n,1)}e.basket().totalShippingCost=a.shippingPrice,e.basket().totalShippingCostString=a.shippingPriceString,e.basket().totalShippingDiscount=a.discountPrice,e.basket().totalShippingDiscountString=a.discountPriceString,e.basket().totalPrice=a.totalPrice,e.basket().totalPriceString=a.totalPriceString,e.basket().totalPoints=a.totalPoints,e.basket().totalPointsString=a.totalPointsString,e.basket().totalItems--,t.product=i(t.product)}})},e.removeAllItems=function(t){for(var a=0;a<e.basket().list.length&&t.product.literalODR!==e.basket().list[a].product.literalODR;a++);o.delete(e.basket().list[a].product.literalODR).then(function(t){e.basket().totalPoints=t.data.totalPoints,e.basket().totalPrice=t.data.totalPrice,e.basket().totalShippingCost=t.data.shippingPrice,e.basket().totalShippingDiscount=t.data.discountPrice},function(e){}),e.basket().list.splice(a,1)},e.removeFromBasket=function(t){o.delete(t.product.literalODR).then(function(o){var a=o.data;if(e.recoverBasket(),a.exception)e.item.exception=a.exception;else{e.basket().totalCost-=parseFloat(t.product.costODR*t.qty),e.basket().totalPoints-=parseFloat(t.product.points*t.qty),e.basket().totalItems-=t.qty;var n=-1;e.basket().list.some(function(e,t){if(e.product.literalODR==this)return n=t,!0},t.product.literalODR),dataLayer.push({event:"removeFromCart",ecommerce:{currencyCode:"eur",remove:{products:[{name:t.product.title,id:t.product.nid,price:t.product.costODR,brand:t.product.brandImage.alt,category:t.product.productType[0].name,variant:"",quantity:t.qty-=e.basket().totalItems}]}}}),e.basket().list.splice(n,1),t.product=i(t.product)}})},e.updateBasket=function(){void 0!==site.isLogged.literalCID&&e.recoverBasket(1)},e.clickProduct=function(t){var o=e.arrayTotalProducts;o.map(function(e){return e.nid}).indexOf(t.nid);dataLayer.push({event:"productClick",ecommerce:{click:{actionField:{list:t.productType[0].name},products:[{name:t.title,id:t.literalODR,price:t.costODR,brand:t.brandImage.alt,category:t.productType[0].name,variant:""}]}}})},e.recoverBasket=function(){o.recover().then(function(a){var i=a.data;if(i.exception)e.items.exception=i.exception;else{if(e.basket().totalShippingDiscount=i.discountPrice,e.basket().totalShippingCost=i.shippingPrice,e.basket().totalPrice=i.totalPrice,e.basket().totalPoints=i.totalPoints,e.basket().totalShippingDiscountString=i.discountPriceString,e.basket().totalShippingCostString=i.shippingPriceString,e.basket().totalPriceString=i.totalPriceString,e.basket().totalPointsString=i.totalPointsString,e.basket().list=$.map(i.list,function(e,t){return[e]}),window.location.href.indexOf("checkout")>-1&&$(document).trigger("ecommerce_load"),e.basket().list.length>0&&(o.setBasket(n(e.basket())),i.loading=!1,void 0!==i.availablePaymentMethod))for(var r=0;r<i.availablePaymentMethod.length;r++)switch(i.availablePaymentMethod[r]){case"pago_gratuito":;break;case"pago_reembolso":e.contraReembolso=!0}t.$emit("basketRecovered",{})}})},e.initProduct=function(t){e.productDetail=t,e.qty=1,void 0!=t.availablePaymentMethod&&t.availablePaymentMethod.length>1&&(e.contraReembolso=!0),e.changeQty=function(t){e.qty=t},e.checkDiscountValidity=function(e){var t=new Date,o=new Date(e.endDate),a=$("#iWantItButtonId");a.attr("disabled",t>o||0==e.numODRDisponiblesConsumidor||void 0!=site.isLogged.literalCID&&parseInt(e.points)>parseInt(site.isLogged.pointsAvailable.replace(".","").replace(",",".")));var n=$("#iWantItButtonIdMobile");return n.attr("disabled",t>o||0==e.numODRDisponiblesConsumidor||void 0!=site.isLogged.literalCID&&parseInt(e.points)>parseInt(site.isLogged.pointsAvailable.replace(".","").replace(",","."))),"disabled"==a.attr("disabled")&&"disabled"==n.attr("disabled")},e.multipleAddToBasketDiscounts=function(t){void 0!==site.isLogged.literalCID?(Utils.loader(),$.ajax("/ajax/cart/redeemProductIntangible",{method:"POST",data:{literalODR:t.literalODR}}).done(function(o){if(Utils.loader(),o.exception){$("#boxIntangibles #confirm").attr("disabled",!0),$("#catalog-error .modal-title").text(o.exception.message),$("#catalog-error .modal-bottom-txt .code").text(void 0!=o.exception.code?o.exception.code:"");new Foundation.Reveal($("#catalog-error")).open()}else{$("#catalogConfirmPopup").foundation("open"),e.productDetail.numODRAvailable=o.numODRAvailable,e.productDetail.numODRDisponiblesConsumidor=o.numODRDisponiblesConsumidor,e.checkDiscountValidity(e.productDetail);var a="";site.isLogged.pointsAvailable=o.pointsAvailable,$("#catalogConfirmPopup").foundation("open");for(var n=0;n<t.productType.length;n++)a+=(""!=a?":":"")+t.productType[n].name;dataLayer.push({ecommerce:{purchase:{actionField:{id:o.cartNumber,affiliation:"online store",revenue:o.totalPrice,tax:"",shipping:o.shippingPrice,coupon:""},products:[{name:t.title,id:t.literalODR,price:t.costODR,brand:t.brandImage.alt,category:a,variant:"",quantity:1,coupon:""}]}}})}}).fail(function(t){Utils.loader(),e.loading=!1,$("#catalogErrorPopup").foundation("open")})):(etiquetado("userManagement","login","acceso","catalogo"),showModalLogin(),$("#loginFormulario .btn-sendform").data("product",t))},e.multipleAddToBasket=function(t){dataLayer.push({event:"productClick",ecommerce:{click:{actionField:{list:t.productType[0].name},products:[{name:t.title,id:t.literalODR,price:t.costODR,brand:t.brandImage.alt,category:t.productType[0].name,variant:"",position:0}]}}}),e.addToBasket(t,e.qty),e.qty=1},e.maxReached=function(e){return 0===parseInt(e.numODRAvailable)},dataLayer.push({ecommerce:{detail:{actionField:{list:t.productType[0].name},products:[{name:t.title,id:t.nid,price:t.costODR,brand:t.brandImage.alt,category:t.productType[0].name,variant:""}]}}}),"object"==typeof site.loggedProduct&&(e.multipleAddToBasketDiscounts(site.loggedProduct),site.loggedProduct=void 0,localStorage.setItem("site",JSON.stringify(site)),sessionStorage.removeItem("loggedProduct")),"object"==typeof site.loggedOriginales&&(e.addToBasket(site.loggedOriginales.product,site.loggedOriginales.qty),site.loggedOriginales=void 0,localStorage.setItem("site",JSON.stringify(site)),sessionStorage.removeItem("loggedOriginales"))},e.initCheckout=function(){if(e.updateBasket(),void 0!==site.isLogged.literalCID){var t={attributes:["tipo_via","direccion","num_via","piso","puerta","DNI/NIF","provincia","codigo_postal","poblacion","telefono_1"]};a.detail(t).then(function(e){var t=e.data;a.add(t),Utils.populateForm(JSON.stringify(t),["checkout1"]),setTimeout(function(){c(1)},5e3)},function(){})}e.send=a.getSend,e.personal=a.getPersonal,e.activeStep="first"};var h=["NIF","codigo_postal","direccion","num_via","piso","poblacion","provincia","puerta","telefono_1","tipo_via"];if(void 0!==site.isLogged[0])for(var b=0;b<h.length;b++)Utils.watching(site.isLogged.attributes,h[b],site.isLogged.attributes[h[b]],function(e){});e.goToStepTwo=function(t){if(!Utils.validateDNINIF(e.send().NIF))return e.send().NIF="",!1;e.submitted=!0,e.activeStep="second",c(2);var o=e.send();o.telefono_1=e.consumer().attributes.telefono_1,a.update(o).then(function(t){if("ok"===t.data.status)for(b=0;b<h.length;b++)site.isLogged.attributes[h[b]]=o[h[b]];var a=document.querySelectorAll(".basket-send li"),n=["tipo_via","direccion","num_via","codigo_postal","poblacion","telefono_1","NIF"];for(b=0;b<a.length;b++)a[b].innerHTML=5===b?"<strong>Telf: </strong>"+o[n[b]]:2===b?o[n[b]]+" - "+o.piso+" - "+o.puerta:6===b?"<strong>NIF: </strong>"+o[n[b]]:o[n[b]];return e.loading=!1,e.submitted=!0,!0},function(e){return e})},e.goToStepThree=function(t){e.clicked=!0,o.redeem(t).then(function(a){var n=a.data;if(n.exception){e.errorCode=n.exception.code;var i=new Foundation.Reveal($("#catalog-error"));i.open(),pushEventPopUp(i.id)}else{var r=n.orderNumber;u=r,e.consumer().pointsAvailable=a.data.pointsAvailable,0!=n&&("pago_tarjeta"==t?(o.paymentResponse(r).then(function(t){n.exception?e.items.exception=n.exception:window.location="/ajax/cart/paymentResponse?orderNumber="+r}),c(3,"visa"),s(a.data,t)):(c(3,"reembolso"),s(a.data,t),e.activeStep="three"))}})},e.backNavigation=function(){"second"==e.activeStep&&(e.activeStep="first"),"second"==e.activeStep&&(e.activeStep="second")},e.paymentStatus=function(t,o,a){var n={};n.step=t,a&&(n.option=a);var i=[];if("ok"==o.status){e.paymentStatusOK=!0;var n=[],r=[];o.paymentCheckList.forEach(function(e,t){if(0==t&&(n={id:e.cartNumber,affiliation:"online store",revenue:e.totalCost,tax:"",shipping:e.costShippingPrice,coupon:""}),void 0!==r[e.literalODR])r[e.literalODR].quantity+=1;else{var o={name:e.descriptionODR,id:e.literalODR,price:e.costODR,brand:"",category:"",variant:"",quantity:1};r[e.literalODR]=o}}),Object.keys(r).forEach(function(e){i.push(r[e])}),dataLayer.push({ecommerce:{purchase:{actionField:n,products:i}}})}else e.paymentStatusKO=!0},e.openModalIntangible=function(){var e=new Foundation.Reveal($("#boxIntangibles"));e.open(),pushEventPopUp(e.id)},e.redeemIntangible=function(t){e.slider=!0,e.intangibleBlocked=!0,void 0!==site.isLogged.literalCID?o.redeemIntangible(t).then(function(t){var o=t.data;if(e.intangibleBlocked=!1,o.exception){switch(o.exception.code){case"ILSCO0553":var a=new Foundation.Reveal($("#cupons_noPoints"));a.open(),pushEventPopUp(a.id);break;case"ILSCO0586":var a=new Foundation.Reveal($("#productLimit"));a.open(),pushEventPopUp(a.id)}}else{e.slider=!1,e.consumer().pointsAvailable=t.data.pointsAvailable;var a=new Foundation.Reveal($("#boxWuakyModal2"));a.open(),pushEventPopUp(a.id),void 0!==o.pointsTotalConsumer&&(e.consumer().pointsAvailable=o.pointsTotalConsumer)}}):(etiquetado("userManagement","login","acceso","catalogo"),showModalLogin(),pushEventPopUp("loginModal"))},e.checkoutCart=function(){({}).step=e.activeStep;var t=[];e.basket().list.forEach(function(e,o){var a={name:e.product.title,id:e.product.literalODR,price:e.product.costODR,brand:e.product.brandImage.alt,category:e.product.productType[0].name,variant:"",quantity:e.qty};t[o]=a})},e.creditCardBtn=!0,e.showCreditCard=function(){e.contraReembolsoBtn=!1,e.creditCardBtn=!0},e.showContraReembolso=function(){e.contraReembolsoBtn=!0,e.creditCardBtn=!1},e.goToProduct=function(e){dataLayer.push({event:"productClick",ecommerce:{click:{actionField:{list:e.productType[0].name},products:[{name:e.title,id:e.literalODR,price:e.costODR,brand:e.brandImage.alt,category:e.productType[0].name,variant:"",position:e.indexCount}]}}}),window.location="/"+e.routeAlias},e.controllerTagEvent=function(e){tagEvent(e)}}]),controllers.controller("promoController",["$scope","Promo","Consumer","$sce","orderByFilter","$window",function(e,t,o,a,n,i){e.consumer=o.get,e.ganadores=!1,e.currentDate=new Date,e.urlUtid="",e.buxFrame=!0,e.ganadoresValor=!1,e.loading=!0,e.winners={},e.isConfirmed="",e.windowWidth=i.innerWidth,e.isMobile=!1,e.isIOS=!1,e.bbllBody=t.bbll,e.existStycky=!0,e.showOldParticipar=!1,e.acceptBasesModal=!1,e.updateAcceptBasesModal=function(t){e.acceptBasesModal=t};var r=function(e){return e.length>25&&(e=e.replace(/^(.{25}[^\s]*).*/,"$1")+"..."),e};e.buxFrameDisabledApp=function(t){e.$watch("consumer().literalCID",function(t){if(void 0!==t&&t==e.consumer().literalCID)return e.buxFrame=!1,window.scrollTo(0,1),$("#promoIframe").show(),$("#page.promoContent").show(),"undefined"!=typeof loadGame&&loadGame(),e.windowWidth<480?e.isMobile=!0:e.isMobile=!1,e.buxFrame})},e.slider=!1,e.slickConfig={dots:!0,infinite:!1,autoplay:!1,speed:300,rows:6,slidesPerRow:1,lazyLoad:"ondemand",centerMode:!1,centerPadding:"60px",arrows:!1},e.slickConfigPromoHome={dots:!0,arrows:!1,infinite:!1,slidesToShow:2,slidesPerRow:1,responsive:[{breakpoint:480,settings:{slidesToShow:1}},{breakpoint:1019,settings:{slidesToShow:1}}]},e.slickConfigPromoEncuesta={dots:!0,arrows:!1,infinite:!1,slidesToShow:2,slidesPerRow:1,responsive:[{breakpoint:480,settings:{slidesToShow:1}},{breakpoint:1019,settings:{slidesToShow:2}}]};var s=function(e,t){var o=null,a=null,n=null;return t?(void 0!=e.other&&(o=e.other.replace("%WIDTH%/%HEIGHT%","960/550"),a=e.other.replace("%WIDTH%/%HEIGHT%","1488/414"),n=e.other.replace("%WIDTH%/%HEIGHT%","1488/414")),null!=e.mobile&&(o=e.mobile.replace("%WIDTH%/%HEIGHT%","960/550"))):void 0!=e&&(o=e.replace("%WIDTH%/%HEIGHT%","614/350"),a=e.replace("%WIDTH%/%HEIGHT%","1440/810"),n=e.replace("%WIDTH%/%HEIGHT%","614/350")),{mobile:o,tablet:a,desktop:n}};e.winners={list:[],listTotal:0,page:1,offset:12,current:1},e.getRandomPromo=function(){t.getList().then(function(o){var a=o.data;if(a.exception)e.exception=a.exception;else{var n=a.promoList,i=[];angular.forEach(n,function(e){"1"==e.active&&i.push(e)}),e.promoList=i[Math.floor(Math.random()*i.length)],t.getDetail(e.promoList.nid,e.promoList.version).then(function(t){if(e.promo=t.data,a.exception)return a.exception;e.promo.endDate=new Date(parseInt(e.promo.endDate+"000")),e.promo.image.url=s(e.promo.image.url),e.promo.totalParticipation=isNaN(parseInt(e.promo.totalParticipation))?0:parseInt(e.promo.totalParticipation),e.promo.totalParticipation=e.promo.totalParticipation.toLocaleString()})}})},e.getList=function(){t.getList().then(function(t){var o=t.data;if(o.exception)e.exception=o.exception;else{e.loading=!1;var a=o.promoList;e.expiredPromos=new Array,e.promoStycky=new Array,e.promoted=new Array,e.activePromos=new Array,a.forEach(function(t,o,a){if(t.endDate=new Date(parseInt(t.endDate+"000")),t.image.url=s(t.image.url),t.totalParticipation=isNaN(parseInt(t.totalParticipation))?0:parseInt(t.totalParticipation),t.totalParticipation=t.totalParticipation.toLocaleString(),t.titleshort=r(t.title),t.endDate<e.currentDate)e.expiredPromos.push(t);else if("0"!=t.sticky){var n={mobile:t.mobileImage.url,other:t.stickyImage.url},i=s(n,!0),c=$("#stycky");new Foundation.Interchange(c,{rules:[" "+i.mobile+", small "," "+i.tablet+", medium "," "+i.desktop+", large "]});e.promoStycky=t}else"0"!=t.promoted?e.promoted.push(t):e.activePromos.push(t)});var n=e.promoted;n=n.slice(1);for(var i=0;i<n.length;i++)e.activePromos.push(n[i]);e.onlyOnePromoLeft=!1,1==e.activePromos.length&&(e.onlyOnePromoLeft=!0),e.promoStycky.nid||(e.existStycky=!1)}},function(e){})},e.getListPromo=function(o){e.isConfirmed=!!o,t.getPromotesList({promoted:!0}).then(function(t){var o=t.data;if(o.exception)e.exception=o.exception;else{var a=o.promoList;new Array;e.homePromoted=new Array,a.forEach(function(t,o,a){t.endDate=new Date(parseInt(t.endDate+"000")),t.totalParticipation=isNaN(parseInt(t.totalParticipation))?0:parseInt(t.totalParticipation),t.totalParticipation=t.totalParticipation.toLocaleString(),t.image.url=s(t.image.url),e.homePromoted.push(t)}),e.loading=!1,e.slider=!0}},function(e){})}}]),controllers.controller("registerController",["$scope","$rootScope","Consumer","Register","$window",function(e,t,o,a,n){e.userRegister={},e.getEmailRegister=a.getEmailRegister;var i=e.userRegister;e.userEmail="a@a.com";document.getElementsByName("csrf-token")[0].getAttribute("content");e.submitForm=!1,e.checkboxModel={b1:!1,b2:!1},e.getLoading=o.getLoading;o.setLoading("false"),$("#loginRegistroNew").on("closed.zf.reveal",function(){s()});var r=new Date;r.setFullYear(r.getFullYear()-18),$("#calendarBornDate").fdatepicker({format:"dd/mm/yyyy",language:"es",leftArrow:"<",rightArrow:">",endDate:r});var s=function(){e.userRegister={},i=e.userRegister,document.getElementById("aviso").checked=!1,document.getElementById("aviso2").checked=!1,$("fieldset").removeClass("errorFieldset"),$("#formulario form input").each(function(e,t){"sexo"!=$(t).attr("name")&&"submit"!=$(t).attr("type")&&$(t).val("")}),e.resetGender();try{document.forms.register.reset()}catch(e){document.forms.register[0].reset()}};e.tryAgain=function(){e.exception={},$("#loginRegistroNew").css({top:"19px"})},e.toggle_formulario=function(){var e=document.getElementById("formulario");"block"==e.style.display?e.style.display="none":e.style.display="block";var t=document.getElementById("mgm_popup_imagen");"block"==t.style.display?t.style.display="none":"none"!=t.style.display&&""!=t.style.display||(t.style.display="block");var o=document.getElementById("loginRegistroNew");"block"==o.style.display?o.style.display="none":"none"!=o.style.display&&""!=o.style.display||(o.style.display="block")},e.registerNewUser=function(t,i,r,s){var c="";try{c=document.location.pathname.split("/")[3].replace(".html","")}catch(e){}var l="";if("viajacondanonecanarias"===c){for(var u=location.search.substring(1),d=/([^&=]+)=([^&]*)/g,p=null;p=d.exec(u);)"sourceConversion"==p[1]&&(l=p[2]);var g=e.checkboxModel.b1?"si":"no",m=e.checkboxModel.b2?"si":"no";""==l&&(l="organico_danone_viajacondanonecanarias"),l="?sourceConversion="+l+"_binter_"+g+"_"+m}void 0!=i.fecha_nacimiento&&(i.fecha_nacimiento=i.fecha_nacimiento.replace(/\./g,"/"),i.fecha_nacimiento=i.fecha_nacimiento.replace(/-/g,"/"));var f=!0;if(void 0!=i.sexo&&""!=i.sexo||(f=!1),($(".fs-promo-code").hasClass("errorFieldset")||""==$.trim(i.promoCode))&&delete i.promoCode,e.submitForm=!0,void 0===s&&(s=!1),e.recruitment=s,t){e.modal_register_loading=!0,void 0!==r&&null!=r&&r.type&&-1!=r.type.indexOf("PROMO")&&(i.nid=r.nid),s&&(i.nid=r.nid),void 0!==QueryString.source&&(i.sourceExternalId=QueryString.source),i.acepta_LOPD="Si",!0===i.publicidad_GDPR?i.publicidad_GDPR="Si":i.publicidad_GDPR="No",i.idioma_comunicaciones="es";var v=$("#loginRegistroNew").attr("data-mgm")||!1;o.register(i,l).then(function(t){var o=t.data;if(o.exception){if($("#loginRegistroNew").css({top:"100px"}),e.exception=o.exception,e.modal_register_loading=!1,i.provider?n.dataLayer.push({event:"userManagement",userManagementCategory:!1===v?"Registrate organico":"Registrate recomendado",userManagementAction:"social register",userManagementLabel:"Datos "+i.provider+": ko"}):n.dataLayer.push({event:"userManagement",userManagementCategory:!1===v?"Registrate organico":"Registrate recomendado",userManagementAction:"Envio",userManagementLabel:e.exception.message}),e.recruitment)if(e.popRecruitCreated)$("#recruitmentKo").foundation("open"),pushEventPopUp("recruitmentKo");else{var r=new Foundation.Reveal($("#recruitmentKo"));r.open(),pushEventPopUp(r.id),e.popRecruitCreated=!0}}else o.url_redirect?(site.isLogged=o,localStorage.setItem("site",JSON.stringify(site)),window.location.pathname==o.url_redirect?n.location.reload():window.location.href=o.url_redirect):(a.setEmailRegister(i.email),e.recruitment||openLoginRegisterModal("loginRegistroCorreo"),e.modal_register_loading=!1),pushEventPopUp("loginRegistroCorreo"),i.provider?n.dataLayer.push({
event:"userManagement",userManagementCategory:!1===v?"Registrate organico":"Registrate recomendado",userManagementAction:"social register",userManagementLabel:"Datos "+i.provider+": ok"}):n.dataLayer.push({event:"userManagement",userManagementCategory:!1===v?"Registrate organico":"Registrate recomendado",userManagementAction:"Envio",userManagementLabel:"ok"}),n.dataLayer.push({event:"userManagement",userManagementCategory:!1===v?"Registrate organico":"Registrate recomendado",userManagementAction:"optin1",userManagementLabel:i.provider?i.provider:"email"}),e.workerWebPush(i.email,"register")},function(e){})}else{if(e.userRegister.socialLoginProvider){var h=$('input[name="emailInputRegister"]').val(),b=$('input[name="passwordRegister"]').val(),y=$('input[name="name"]').val();""===h&&$('input[name="emailInputRegister"]').parent().parent().addClass("errorFieldset"),""===b&&$('input[name="passwordRegister"]').parent().parent().addClass("errorFieldset"),""===y&&$('input[name="name"]').parent().parent().addClass("errorFieldset")}else $(".registerInput").each(function(){""==$(this).val()?$(this).parent().parent().addClass("errorFieldset"):$(this).parent().parent().removeClass("errorFieldset")});$("#aviso,#aviso2")[0].checked?($("#aviso,#aviso2").parent().find("label").css("color",""),$("#aviso,#aviso2").parent().find("a").css("color","")):($("#aviso,#aviso2").parent().find("label").css("color","red"),$("#aviso,#aviso2").parent().find("a").css("color","red")),$("#registerFormulario ingit statusput.ng-empty").each(function(e,t){$(t).closest("fieldset").hasClass("fs-no-required")||$(t).closest("fieldset").addClass("errorFieldset")}),f||i.socialLoginProvider||$(".img-radio-gender").attr("src","/images/modals/loginregister/radio-gender-error.png")}},t.$on("refreshGigyaRegisterUserFields",function(t,o){e.refreshGigyaRegisterUserFields(o)}),e.refreshGigyaRegisterUserFields=function(t){e.userRegister.nombre=t.name,e.userRegister.email=t.email,e.userRegister.url_imagen=t.photoURL,e.userRegister.provider=t.provider,e.userRegister.fromSocial=!0;var o=void 0;document.getElementById("socialLoginProvider1").value?o=document.getElementById("socialLoginProvider1").value:document.getElementById("socialLoginProvider2").value&&(o=document.getElementById("socialLoginProvider2").value),o&&(e.userRegister.socialLoginProvider=o,$("#lottery-message").show(),$(".loginModal-socialregister").hide()),$(".red-warning").css("color","red"),$('input[name="emailInputRegister"]').prop("disabled",!0)};o.get;e.exception=o.exception,e.getIphone=function(){void 0!==site.isLogged.literalCID&&(o.detail().then(function(e){var t=e.data;o.add(t)},function(){}),e.send=o.getSend,e.personal=o.getPersonal)},e.updateConsumerData=function(){var t=merge(e.personal(),e.send());o.update(t).then(function(t){if(void 0===t.exception){var a={consumerId:o.get().literalCID,literalODR:"sorteo_2312_completardatos_recualificacion_iphone7",quantity:"1"};o.redeem(a).then(function(t){if(void 0===t.data.exception)var o=new Foundation.Reveal($("#auctionsSendConfirm"));else{e.exception(t.data.exception);var o=new Foundation.Reveal($("#auctionsSendError"))}o.open(),pushEventPopUp(o.id)},function(e){return e})}else{e.exception=t.exception;var n=new Foundation.Reveal($("#auctionsSendError"));n.open(),pushEventPopUp(n.id)}return e.loading=!1,e.submitted=!0,!0},function(e){return e})},e.closeErrorPopup=function(){$("#recruitmentKo").foundation("close")},e.closeKoSendingPassMail=function(){$("#recover-password-ko").foundation("close")},e.closeOkSendingPassMail=function(){$("#recover-password-ok").foundation("close")},e.registerModal=function(e){$("#"+e).foundation("open").on("closed.zf.reveal",function(){showModalRegister(),pushEventPopUp("loginRegistroNew")})},e.checkGender=function(e){var t,o,a=$(e).attr("id"),n=$(e).attr("src");"radioWomanGender"==a?(t="#genderWoman",o="mujer"):"radioManGender"==a&&(t="#genderMan",o="hombre"),$("#genderWoman").prop("checked",!1),$("#genderMan").prop("checked",!1),"/images/modals/loginregister/radio-gender-unchecked.png"!=n&&"/images/modals/loginregister/radio-gender-error.png"!=n||($(".radio-gender").hasClass("errorFieldset")&&$(".radio-gender").removeClass("errorFieldset"),$(".img-radio-gender").attr("src","/images/modals/loginregister/radio-gender-unchecked.png"),$(e).attr("src","/images/modals/loginregister/radio-gender-checked.png"),$(t).prop("checked",!0),i.sexo=o)},e.resetGender=function(){$("#genderWoman").prop("checked",!1),$("#genderMan").prop("checked",!1),$(".radio-gender").hasClass("errorFieldset")&&$(".radio-gender").removeClass("errorFieldset"),$(".img-radio-gender").attr("src","/images/modals/loginregister/radio-gender-unchecked.png")}}]),controllers.controller("savingController",["$scope","$rootScope","Saving","Consumer","Coupon","$sce","$window",function(e,t,o,a,n,i,r){function s(t,o,a){t.canjeList&&("accepted"==o&&(e.acceptedCoupon=!0),"refused"==o&&(e.refusedCoupon=!0),t.canjeList.forEach(function(e,n,i){e.totalQuantity=0,e.totalSave=0,e.totalPoints=0,e.couponCashbackList.forEach(function(n){e.totalQuantity+=parseInt(n.quantity),e.totalSave+=parseFloat(n.discount*n.quantity),e.totalSaveString=e.totalSave.toFixed(2).toString().replace(".",",").replace(/\B(?=(\d{3})+(?!\d))/g,"."),"pending"==o&&c(n,function(){e.totalPoints+=parseFloat(n.detail.pointsValue)*n.quantity}),a(t)})}))}function c(e,t){var o=e.couponId;n.detail(o,null).then(function(a){var n=a.data[o];n.exception?e.detail=n.exception:(n.image.url=n.image.url.replace("%WIDTH%/%HEIGHT%","132/76"),e.detail=n,t(e))})}e.consumerStatusDetail=o.consumerStatusDetail,e.consumerStatusDetailPaymentRequested=o.consumerStatusDetailPaymentRequested,e.consumer=a.get,e.couponDetail=n.detail;var l=(document.getElementsByName("csrf-token")[0].getAttribute("content"),"");e.pendingCoupon=!1,e.refusedCoupon=!1,e.acceptedCoupon=!1,e.payedAmount=0,e.pendingAmount=0,e.refusedAmount=0,e.acceptedAmount=0,e.acceptedAmountString="",e.requestedAmount=0,e.isActive=[],e.isActiveRefuse=[],e.quantity=0,e.points=0,e.save=0,e.toggleItem=function(t){e.isActive[t]=!e.isActive[t]},e.toggleItemRefuse=function(t){e.isActiveRefuse[t]=!e.isActiveRefuse[t]},e.getMyMoneyBack=function(t){e.loading=!0,o.getMyMoneyBack(t).then(function(t){e.loading=!1;var o=t.data;if(o.exception)e.exception=o.exception;else{e.cashbackPayUrl=o.urlSecure,e.casbackPayUrlSecure=i.trustAsResourceUrl(e.cashbackPayUrl);var a=new Foundation.Reveal($("#cashbackGetMyMoney"));a.open(),pushEventPopUp(a.id),r.dataLayer.push({event:"hucha",event_category:"hucha",event_action:"Ingresar en mi cuenta"})}})},e.savingInit=function(){e.loading=!0,o.consumerStatusDetail(l,"refused").then(function(t){e.loading=!1;var o=t.data;o.exception?e.exception=o.exception:(o.canjeList&&(e.refusedCoupon=!0),e.refusedCouponData=o.canjeList,e.acceptedAmount=o.acceptedAmount?o.acceptedAmount:0,e.payedAmount=o.payedAmount,e.pendingAmount=o.pendingAmount?o.pendingAmount:0,e.refusedAmount=o.refusedAmount,e.requestAmount=o.requestAmount?o.requestAmount:0,e.getMoney=!1,e.acceptedAmount>0&&(e.getMoney=!0,e.acceptedAmountString=e.acceptedAmount.toFixed(2).toString().replace(".",",").replace(/\B(?=(\d{3})+(?!\d))/g,".")))}),o.consumerStatusDetail(l,"pending").then(function(t){var o=t.data;o.exception?e.exception=o.exception:s(o,"pending",function(){e.pendingCouponData=o.canjeList,e.pendingCoupon=!0})}),o.consumerStatusDetail(l,"accepted").then(function(t){var o=t.data;o.exception?e.exception=o.exception:s(o,"accepted",function(){e.acceptedCouponData=o.canjeList})})},void 0!==site.isLogged.literalCID&&(e.savingInit(),l=e.consumer().literalCID),e.savingTagEvent=function(e){tagEvent(e)}}]),controllers.controller("searchController",["$scope","Search","Coupon","$window",function(e,t,o,a){e.searchList=[],e.filters={},e.noResults=!1,e.windowWidth=a.innerWidth;var n=e.searchList;e.searchArrayCoupon=[],e.coupon=[],e.couponQty=0,e.literalODRArray=[],e.versionNumberArray=[],e.initSearcher=function(a){t.getList(a).then(function(t){var a=t.data;if(a.exception)"ILSRV0425"==a.exception.code&&(e.all=0,e.saludQty=0,e.recetasQty=0,e.familiaQty=0,e.couponQty=0,e.noResults=!0);else{var a=t.data;a.searchList.forEach(function(t){if("coupon"==t.type){e.couponQty++;var o=t;e.literalODRArray.push(o.info.literalODR),e.versionNumberArray.push(o.version)}else n.push(t),0==n.length&&(e.noResults=!0);e.all=n.length,e.resetAll=e.searchList}),o.detail(e.literalODRArray,e.versionNumberArray).then(function(t){var o=t.data;if(o.exception)e.coupon.exception=o.exception;else{null!=o.variety&&(o.variety=o.variety.replace(/,/g,"<br/>",!0));$.map(o,function(e,t){return[e]}).forEach(function(t){e.searchArrayCoupon.push(t),n.push(t),e.all=n.length})}});var i=n.filter(function(e){return"YOGUR"==e.info.tags||"DEFENSAS"==e.info.tags||"DIGESTION"==e.info.tags||"COLESTEROL"==e.info.tags||"DIETA"==e.info.tags||"OSEO"==e.info.tags||"AGUA"==e.info.tags||"EJERCICIOS"==e.info.tags||"DIGESTION"==e.info.tags});e.saludQty=i.length,e.salud=i;var r=n.filter(function(e){return"COMIDAS"==e.info.tags||"DESAYUNOS"==e.info.tags||"CENAS"==e.info.tags||"POSTRES"==e.info.tags||"BEBIDAS"==e.info.tags||"MERIENDAS"==e.info.tags||"RECETAS"==e.info.tags});e.recetasQty=r.length,e.recetas=r;var s=n.filter(function(e){return"EMBARAZO"==e.info.tags||"BEBE"==e.info.tags||"NIÑOS"==e.info.tags||"AHORRO"==e.info.tags||"FAMILIA Y HOGAR"==e.info.tags});e.familiaQty=s.length,e.familia=s}})},e.searchInputTxt={}}]),controllers.controller("socialLoginController",["$scope","$rootScope","Consumer","$window",function(e,t,o,a){t.$on("event:social-sign-in-success",function(n,i){if(o.setLoading("true"),$(".to-hide").removeClass("to-hide"),"undefined"==i.email||void 0==i.email)t.$emit("refreshGigyaRegisterUserFields",i),$("a[data-open='loginRegistro']").click(),o.setLoading("false");else{if(document.getElementById("mgmPopup")){"mgmPopup"==("block"==document.getElementById("mgmPopup").style.display?"mgmPopup":"loginRegistro")?(o.consumerCheck({user:btoa(JSON.stringify(i))}).then(function(e){void 0!=e.data.exception&&(showModalRegister(),t.$emit("refreshGigyaRegisterUserFields",i))}),o.setLoading("false")):("es"==language?($(".facebook-social-message").text("Estamos validando tu usuario"),$(".google-social-message").text("Estamos validando tu usuario")):"ca"==language&&($(".facebook-social-message").text("Estem validant el teu usuari"),$(".google-social-message").text("Estem validant el teu usuari")),o.checkUpdateCid({user:btoa(JSON.stringify(i))}).then(function(n){var r=n.data,s="";e.modal_loading=!0,!1===r?(t.$emit("refreshGigyaRegisterUserFields",i),$(".link-modallogin").click(),s="validacion "+i.provider):void 0===r.exception?(o.add(r),localStorage.setItem("site",JSON.stringify(site)),$(".loginModal").foundation("close"),s="login completado:"+i.provider,a.dataLayer.push({event:"userManagement",userManagementCategory:"login",userManagementAction:"social login",userManagementLabel:i.provider+" ok"})):(t.exception=r.exception,s="login incorrecto:"+r.exception.message,a.dataLayer.push({event:"userManagement",userManagementCategory:"login",userManagementAction:"social login",userManagementLabel:i.provider+" ko:"+e.exception.message})),o.setLoading("false"),a.dataLayer.push({event:"login",event_category:"login",event_action:"login gigya",event_label:s}),void 0!==r.status&&a.location.reload(),$(".facebook-social-message").hide(),$(".google-social-message").hide(),$("#lottery-message").show(),e.workerWebPush(r.literalCID,"login")}))}else"es"==language?($(".facebook-social-message").text("Estamos validando tu usuario"),$(".google-social-message").text("Estamos validando tu usuario")):"ca"==language&&($(".facebook-social-message").text("Estem validant el teu usuari"),$(".google-social-message").text("Estem validant el teu usuari")),o.checkUpdateCid({user:btoa(JSON.stringify(i))}).then(function(n){var r=n.data,s="";e.modal_loading=!0,!1===r?(t.$emit("refreshGigyaRegisterUserFields",i),$("#link-modalregister").click(),s="validacion "+i.provider):void 0===r.exception?(o.add(r),localStorage.setItem("site",JSON.stringify(site)),$(".loginModal").foundation("close"),s="login completado:"+i.provider,a.dataLayer.push({event:"userManagement",userManagementCategory:"login",userManagementAction:"social login",userManagementLabel:i.provider+" ok"}),language=location.pathname.slice(1,3),location.reload()):(t.exception=r.exception,s="login incorrecto:"+r.exception.message,a.dataLayer.push({event:"userManagement",userManagementCategory:"login",userManagementAction:"social login",userManagementLabel:i.provider+" ko:"+e.exception.message})),o.setLoading("false"),a.dataLayer.push({event:"login",event_category:"login",event_action:"login gigya",event_label:s}),$(".facebook-social-message").hide(),$(".google-social-message").hide(),$("#lottery-message").show(),e.workerWebPush(r.literalCID,"login")})}})}]),controllers.controller("sonrisasSolidariasController",["$scope","$rootScope","$window","SonrisasSolidarias","Consumer",function(e,t,o,a,n){var i=function(e){var t=new Foundation.Reveal($(e));t.open(),pushEventPopUp(t.id)};e.points=0,e.SonrisasSolidarias=a.get,e.consumer=n.get,e.init=function(){a.getBancoAlimentosYearPoints().then(function(t){var o=t.data;if(e.data=o,o.exception){o.exception.code}else e.pointsYearValue=parseInt(o.food_units)},function(e){})},e.poderSonrisa=function(){a.getDonatedPoints("risas_emergencia").then(function(t){var o=t.data;if(e.data=o,o.exception){o.exception.code}else{e.limitPoints=o.limitRedemptionODR;var a=o.pointsRedemptionConsumerAmount,n=a.replace(".","");e.points=parseInt(n)/75,e.points>e.limitPoints&&(e.points=e.limitPoints),e.progressBar=100*e.points/e.limitPoints}},function(e){})},e.donateIntangiblePoints=function(){a.redeemIntangible("risas_emergencia").then(function(t){var o=t.data;if(e.data=o,o.exception){var a=o.exception.code;if("ILSCO0553"==a){var n=new Foundation.Reveal($("#cupons_noPoints"));n.open(),pushEventPopUp(n.id)}else if("ILCDI0001"==a||"ILSCO0586"==a){var n=new Foundation.Reveal($("#limitSonrisas"));n.open(),pushEventPopUp(n.id)}else{var n=new Foundation.Reveal($("#limitSonrisas"));n.open(),pushEventPopUp(n.id)}}else{e.points,e.progressBar=e.points/100,void 0!==o.pointsTotalConsumer&&(e.consumer().pointsAvailable=o.pointsTotalConsumer);var n=new Foundation.Reveal($("#donateSonrisasConfoirmationOk"));n.open(),pushEventPopUp(n.id)}},function(e){})},e.fesbal=function(){i("#idssBancoAlimentosFESBAL")},e.keyUp=function(t){parseFloat(e.points)<=parseInt(e.consumer().pointsAvailable.replace(".",""))?(e.points=parseFloat(e.points.toString().replace(".","")),e.pointsEven=Math.floor(e.points/2),e.points=e.points.toString().replace(/\B(?=(\d{3})+(?!\d))/g,"."),e.products=angular.copy(e.pointsEven.toString().replace(/\B(?=(\d{3})+(?!\d))/g,"."))):e.products=""},e.submitFormBancoAlimentos=function(t){if(!t.$invalid){e.blockSubmit=!0;var o={points:t.points.$viewValue.replace(".",""),products:t.products.$viewValue.replace(".","")};a.set(o),"false"==typeof e.consumer().transactionAllowed?i("#loginCorreoFinal24"):a.submitBancoAlimentosForm(o).then(function(t){if("ok"==t.data.status)i("#idssBancoAlimentosResult"),dataLayer.push({event:"donacion_envio",event_category:"donaciones",event_action:"Banco de Alimentos",event_label:"donacion completada",puntos:o.points});else{$("#popupErrorDefault .modal-bottom-txt").html(t.data.exception.message);var a="Código de error";"ca"==language&&(a="Codi d'error"),$("#popupErrorDefault .modal-bottom-error-code").html("["+a+": <b>"+t.data.exception.code+"</b>]"),i("#popupErrorDefault"),dataLayer.push({event:"donacion_error",event_category:"donaciones",event_action:"Banco de Alimentos",event_label:"error:"+t.data.exception.message})}document.getElementById("formBancoAlimentos").reset(),document.getElementById("points").value=0,e.blockSubmit=!1,e.points=0},function(e){dataLayer.push({event:"donacion_error",event_category:"donaciones",event_action:"Banco de Alimentos",event_label:"error:"+e.data.exception.message})})}},e.donatepoints=function(){i("#idssPoderSonrisaPointsResult")},e.donatePointsResult=function(){i("#idssResultThanks")},e.donateSharedMail=function(){i("#idssSharedMail")},e.donateSharedThanks=function(){i("#idssSharedMail")},e.openDonateSonrisasPopup=function(){e.consumer().literalCID?i("#donateSonrisasConfoirmation"):(showModalLogin(),pushEventPopUp("loginModal"))}}]),controllers.controller("webPushController",["$scope","$rootScope","Consumer","$window",function(e,t,o,a){e.workerWebPush=function(e,t){-1!=navigator.userAgent.indexOf("Speed Insights")||-1===document.location.hostname.indexOf(".es")&&-1===document.location.hostname.indexOf(".pt")||function e(t,o,a){function n(r,s){if(!o[r]){if(!t[r]){var c="function"==typeof require&&require;if(!s&&c)return c(r,!0);if(i)return i(r,!0);var l=new Error("Cannot find module '"+r+"'");throw l.code="MODULE_NOT_FOUND",l}var u=o[r]={exports:{}};t[r][0].call(u.exports,function(e){var o=t[r][1][e];return n(o||e)},u,u.exports,e,t,o,a)}return o[r].exports}for(var i="function"==typeof require&&require,r=0;r<a.length;r++)n(a[r]);return n}({1:[function(t,a,n){"serviceWorker"in navigator&&(navigator.serviceWorker.register("/service-worker.js").then(function(){},function(e){}),navigator.serviceWorker.ready.then(function(t){t.pushManager.subscribe({userVisibleOnly:!0}).then(function(t){var a={consumerId:e,push_os_platform:null,push_os_version:null,push_browser_platform:null,push_browser_version:null,push_acceptance:"si",push_token_endpoint:t.endpoint,push_token_auth:btoa(String.fromCharCode.apply(null,new Uint8Array(t.getKey("auth")))),push_token_p256dh:btoa(String.fromCharCode.apply(null,new Uint8Array(t.getKey("p256dh"))))};a.push_os_version=navigator.userAgent.substr(0,navigator.userAgent.indexOf(")")).substring(navigator.userAgent.length,navigator.userAgent.indexOf("(")+1),-1!=window.navigator.userAgent.indexOf("Windows")?a.push_os_platform="Windows":-1!=window.navigator.userAgent.indexOf("Mac")?a.push_os_platform="Mac":-1!=window.navigator.userAgent.indexOf("Linux")?a.push_os_platform="Linux":a.push_os_platform="otro";var n={Chrome:/chrome/i,Safari:/safari/i,Firefox:/firefox/i,MSIE:/msi/i,Opera:/opera/i};a.push_browser_platform="Otro";for(var i in n)if(n[i].test(window.navigator.userAgent)){a.push_browser_platform=i;break}a.push_browser_version=function(){var e,t=navigator.userAgent,o=t.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[];return/trident/i.test(o[1])?(e=/\brv[ :]+(\d+)/g.exec(t)||[],"IE "+(e[1]||"")):"Chrome"===o[1]&&null!=(e=t.match(/\b(OPR|Edge)\/(\d+)/))?e.slice(1).join(" ").replace("OPR","Opera"):(o=o[2]?[o[1],o[2]]:[navigator.appName,navigator.appVersion,"-?"],null!=(e=t.match(/version\/(\d+)/i))&&o.splice(1,1,e[1]),o.join(" "))}(),void 0!==e&&o.update(a)},function(e){})}))},{}]},{},[1])}}]),services.factory("AddPoints",["$http",function(e){var t={},o={};return{addPoints:function(t){var o={pincode:t};return e.post("/ajax/consumer/addpoints",o)},set:function(e){t=e},get:function(){return t},setPoints:function(e){o=e},getPoints:function(){return o}}}]),services.factory("Auction",["$http",function(e){var t={ok:!1,ko:!1,title:null,message:null,code:null},o={};return{list:function(t,o,a,n,i){var r={status:t,sticky:o,promoted:a,literalAuction:n,rowCount:i};return e.post("/ajax/auction/getList",r)},doBid:function(t){var t=t;return e.post("/ajax/auction/bid",t)},notify:function(t){var t=t;return e.post("/ajax/auction/notify",t)},result:function(e){return void 0!==e&&(t=e),t},bid:function(e){return void 0!==e&&(o=e),o}}}]),services.factory("Brands",["$http",function(e){var t=[];return{getDetail:function(t,o){var a={nid:t};return e.post("/ajax/sku/getDetail",a)},getList:function(){return e.post("/ajax/sku/getList")},getbrand:function(){return e.post("/ajax/sku/brand")},setNid:function(e){t=e},getNid:function(){return t}}}]),services.factory("Cashback",["$http",function(e){var t="",o=0,a=1;return{list:function(t){var o={type:t};return e.post("/ajax/coupon/getList",o)},getImages:function(){return e.post("/ajax/cart/getTicketCashbackCart")},redeemCashbackCart:function(t,o){var a={idCanje:t,numCesta:o};return e.post("/ajax/cart/redeemCouponCashbackCart",a)},addImages:function(t){var o={ticketList:t};return e.post("/ajax/cart/addTicketCashbackCart",o)},removeImages:function(t){var o={filePath:t};return e.post("/ajax/cart/removeTicketCashbackCart",o)},setFilename:function(e){t=e},getFilename:function(){return t},setStep:function(e){a=e},getStep:function(){return a},setImageNumber:function(e){o=e},getImageNumber:function(){return o}}}]),services.factory("Consumer",["$http",function(e){var t=site.isLogged,o={},a={},n={},i={},r=function(e,t){var o={};for(var a in e)o[a]=e[a];for(var a in t)o[a]=t[a];return o},s="",c=!1;return{add:function(e){if(t=r(t,e),void 0!==e&&void 0!==e.literalCID){var i=e.attributes.fecha_nacimiento;if(void 0!==i&&null!=i){var s=i.slice(0,10).split("/");i=new Date(s[2]+"/"+s[1]+"/"+s[0])}o={nombre:e.attributes.nombre,apellido_1:e.attributes.apellido_1,apellido_2:e.attributes.apellido_2,sexo:e.attributes.sexo,email:e.email,telefono_1:e.attributes.telefono_1,NIF:e.attributes.NIF,fecha_nacimiento:i},a={tipo_via:e.attributes.tipo_via,direccion:e.attributes.direccion,num_via:e.attributes.num_via,piso:e.attributes.piso,puerta:e.attributes.puerta,NIF:e.attributes.NIF,codigo_postal:e.attributes.codigo_postal,poblacion:e.attributes.poblacion,provincia:e.attributes.provincia},n={idioma_comunicaciones:e.attributes.idioma_comunicaciones,publicidad_GDPR:e.attributes.publicidad_GDPR,no_cesion_terceros:e.attributes.no_cesion_terceros}}},get:function(){return t},getPersonal:function(){return o},getSend:function(){return a},getComm:function(){return n},login:function(t){return e.post("/ajax/consumer/login",t)},isLogged:function(){return e.post("/ajax/consumer/isLogged")},logout:function(){return e.post("/ajax/consumer/logout")},restorePass:function(){return e.post("/ajax/consumer/logout")},register:function(t,o){return e.post("/ajax/consumer/registry"+o,t)},validate:function(t){return e.post("/ajax/consumer/consumerValidation",t)},restore:function(){return e.post("/ajax/consumer/logout")},detail:function(t){return void 0!=t?e.post("/ajax/consumer/getDetails",t):e.post("/ajax/consumer/getDetails")},update:function(t){return e.post("/ajax/consumer/consumerUpdate",t)},changePassword:function(t){return e.post("/ajax/consumer/changePassword",t)},checkOldPassword:function(t){return e.post("/ajax/consumer/checkOldPassword",t)},pointsHistory:function(t){var o={page:t};return e.post("/ajax/consumer/consumerHistoric",o)},ordersHistory:function(t,o){var a={type:t,page:o};return e.post("/ajax/consumer/consumerOrders",a)},setLocale:function(t){return e.post("/ajax/parent/setLocale",t)},restorePassword:function(t){var o={consumerId:t,sendPassword:"0"};return e.post("/ajax/consumer/restorePassword",o)},setErrorPassword:function(e){s=e},fetErrorPassword:function(e){return s},checkUpdateCid:function(t){return e.post("/ajax/consumer/checkUpdateCid",t)},consumerCheck:function(t){return e.post("/ajax/consumer/consumerCheck",t)},redeem:function(t){return e.post("/ajax/consumer/consumerRedeemPoints",t)},exception:function(e){return void 0!==e&&(i=e),i},setLoading:function(e){c=e},getLoading:function(){return c},getLogged:function(){return void 0!==window.site.isLogged.literalCID}}}]),services.factory("Content",["$http",function(e){var t=["Oikos","Densia","Savia","Danonino","Danacol","Mi Primer Danone","Actimel","Activia","Danone Cremoso","Vitalinea"],o=["Levité","Font Vella","Lanjarón"],a=["Sin gluten","Sin lactosa","Sin grasa"],n=["Postres","Para llevar","Para beber","Cremosos","Edulcorados","Con frutas","Con calcio","Con fibras","Buena digestión","Para el colesterol","Desnatados","Naturales","Niños"],i=["Novedades","Artículos Danone","Todo para el hogar","Planes y escapadas","Cursos a distancia","Cine en casa","Libros y suscripciones","Ofertas exclusivas"],r=["Cocina","Decoración","Esenciales hogar","Tecnología","Deportes","Niños"],s=["Comidas","Cenas","Postres","Bebidas","Meriendas","Desayunos"],c=["Fácil","Media","Difícil"],l={};return{getTags:function(){return l},setTags:function(e){l=e},getList:function(t,o,a,n,i,r,s,c,l){var u={difficulty:o,tags:a,sticky:n,rowcount:i,freeTags:t,brand:r,isMenu:s,priorityMaxValue:c,priorityTypeOrder:l};return e.post("/ajax/article/getList",u)},getDetail:function(t,o,a){var n={nid:t,type:o,version:a};return e.post("/ajax/article/getDetail",n)},getAccordion:function(e){switch(e){case"marcas":return t;case"aguas":return o;case"sins":return a;case"especialidades":return n;case"secciones":return i;case"tipologias":return r;case"recetas":return s;case"dificultades":return c}}}}]),services.factory("Coupon",["$http",function(e){var t=!1,o={print:{list:[],totalItems:0,totalPoints:0,totalRefund:0},cashback:{list:[],totalItems:0,totalPoints:0,totalRefund:0}},a=null;return{list:function(t,o){var a={type:t,brand:o};return e.post("/ajax/coupon/getList",a)},detail:function(t,o){var a={literalODR:t,version:o};return e.post("/ajax/coupon/getDetail",a)},detailList:function(t,o){var a={literalODR:t,version:o};return e.post("/ajax/coupon/getDetailList",a)},check:function(t,o){var a={literalODR:t};return"cashback"==o?e.post("/ajax/cart/addCouponCashbackCart",a):e.post("/ajax/cart/addCouponCart",a)},remove:function(t,o){var a={literalODR:t};return"cashback"==o?e.post("/ajax/cart/removeCouponCashbackCart",a):e.post("/ajax/cart/removeCouponCart",a)},delete:function(t,o){var a={literalODR:t};return"cashback"==o?e.post("/ajax/cart/removeCouponsCashbackCart",a):e.post("/ajax/cart/removeCouponsCart",a)},recover:function(t){return a=t,"cashback"==t?e.post("/ajax/cart/getCouponCashbackCart"):e.post("/ajax/cart/getCouponCart")},redeem:function(t){return e.post("/ajax/cart/redeemCouponCart",t)},setBasket:function(e){o[a]=e},getBasket:function(){return o[a]},getEnvironment:function(){return a},setBlocked:function(e){t=e},getBlocked:function(){return t}}}]),services.factory("ChangePassword",["$http",function(e){return{submitFormChangePass:function(t){return e.post("/ajax/consumer/changePassword",t)}}}]),services.factory("Promo",["$http",function(e){var t="";return{getDetail:function(t,o){var a={nid:t,version:o};return e.post("/ajax/promo/getDetail",a)},getList:function(){return e.post("/ajax/promo/getList")},getPromotesList:function(t){return e.post("/ajax/promo/getList",t)},getUserPromo:function(t,o,a,n){var i={nid:t,instantWins:o,page:a,offset:n};return e.post("/ajax/instantWin/winnerList",i)},autoLogin:function(){return e.post("/ajax/consumer/consumerAutologingeneration")},bbll:function(e){return e&&(t=e),t}}}]),services.factory("Product",["$http",function(e){var t=[],o=[],a={list:[],totalItems:0,totalPoints:0,totalRefund:0,totalCost:0,totalShippingCost:0},n=[];return{getList:function(t,o){var a={tid:t,sticky:o};return e.post("/ajax/product/getList",a)},getTypeList:function(t){var o={type:t};return e.post("/ajax/product/typeList",o)},detail:function(t,o){var a={literalODR:t,version:o};return e.post("/ajax/product/getDetail",a)},detailList:function(t,o){var a={literalODR:t,version:o};return e.post("/ajax/product/getDetailList",a)},secciones:function(e){return e&&(t=e),t},tipologias:function(e){return e&&(o=e),o},add:function(t){var o={literalODR:t};return e.post("/ajax/cart/addProductCart",o)},remove:function(t){var o={literalODR:t};return e.post("/ajax/cart/removeProductCart",o)},delete:function(t){var o={literalODR:t};return e.post("/ajax/cart/removeProductsCart",o)},recover:function(){return e.post("/ajax/cart/getProductCart")},redeem:function(t){var o={paymentMethod:t};return e.post("/ajax/cart/redeemProductCart",o)},setBasket:function(e){a=e},getBasket:function(){return a},setProduct:function(e){n=e},getProduct:function(){return n},redeemIntangible:function(t){var o={literalODR:[t]};return e.post("ajax/cart/redeemProductIntangible",o)},paymentResponse:function(t){var o={orderNumber:t};return e.post("ajax/cart/paymentResponse",o)}}}]),services.factory("Register",["$http",function(e){var t="";return{setEmailRegister:function(e){t=e},getEmailRegister:function(){return t}}}]),services.factory("Saving",["$http",function(e){return{consumerStatusDetail:function(t,o){var a={consumerId:t,amountType:o};return e.post("/ajax/cashback/consumerStatusDetail",a)},consumerStatusDetailPaymentRequested:function(t){var o={consumerId:t};return e.post("/ajax/cashback/consumerStatusDetailPaymentRequested",o)},getMyMoneyBack:function(t){var o={consumerId:t};return e.post("/ajax/cashback/paymentURL",o)}}}]),services.factory("Search",["$http",function(e){return{getList:function(t){var o={keys:t};return e.post("/ajax/search/getList",o)}}}]),services.factory("SonrisasSolidarias",["$http",function(e){var t={};return{set:function(e){t=e},get:function(){return t},submitBancoAlimentosForm:function(t){return e.post("/ajax/donation/discountPointsDonation",t)},getBancoAlimentosYearPoints:function(){return e.post("/ajax/donation/pointsDonationYearNow")},getDonatedPoints:function(t){var o={literalODR:t};return e.post("/ajax/consumer/consumerPointsRedemptionAmount",o)},redeemIntangible:function(t){var o={literalODR:[t]};return e.post("/ajax/cart/redeemProductIntangible",o)}}}]),asApp.directive("backImg",[function(){return function(e,t,o){o.$observe("backImg",function(e){for(var o=["#508cbe","#e0afc4","#feaf6c","#82caa5","#e45654","#7274a4","#ffd14a","#727272"],a=t,n=a.length-1;n>=0;n--){var i=Math.floor(Math.random()*o.length);$(a[n]).css("background-color",o[i])}})}}]),asApp.directive("checkData",["$http","$q",function(e,t){return{require:"ngModel",link:function(t,o,a,n){var i=n;t.$watch(a.ngModel,function(t){void 0!==t&&e.post("/ajax/consumer/consumerCheck",{email:t}).then(function(e){e.data.exist?i.$setValidity("emailNotUsed",!1):0==e.data.exist?(i.$setValidity("emailNotUsed",!0),i.$setValidity("emailValido",!0)):"ILSRV0119"!=e.data.exception.code&&"ILREG0271"!=e.data.exception.code||(i.$setValidity("emailNotUsed",!0),i.$setValidity("emailValido",!1))},function(e){i.$setValidity("emailNotUsed",!1)})})}}}]),asApp.directive("checkPromocode",["$http","$q",function(e,t){return{require:"ngModel",link:function(t,o,a,n){t.$watch(a.ngModel,function(t){void 0!==t&&e.post("/ajax/consumer/consumerPromoCodeCheck",{promoCode:t}).then(function(e){var t="incorrecto";0==e.data.correct&&""!=e.data.promoCode?($(".fs-promo-code").addClass("errorFieldset"),$(".promocode-warning").html("ca"===language?"Aquest codi no és vàlid.":"Este código no es válido.")):($(".fs-promo-code").removeClass("errorFieldset"),t="correcto"),""!=e.config.data.promoCode&&"object"==typeof dataLayer&&dataLayer.push({event:"codigo promocional",event_category:"registrate organico",event_action:"codigo promocional",event_label:t})})})}}}]),asApp.directive("ngThumb",["$window",function(e){var t={support:!(!e.FileReader||!e.CanvasRenderingContext2D),isFile:function(t){return angular.isObject(t)&&t instanceof e.File},isImage:function(e){return-1!=="|jpg|png|jpeg|bmp|gif|".indexOf("|"+e.type.slice(e.type.lastIndexOf("/")+1)+"|")}};return{restrict:"A",template:"<canvas/>",link:function(e,o,a){function n(e){var t=new Image;t.onload=i,t.src=e.target.result}function i(){var e=r.width||this.width/this.height*r.height,t=r.height||this.height/this.width*r.width;s.attr({width:e,height:t}),s[0].getContext("2d").drawImage(this,0,0,e,t)}if(t.support){var r=e.$eval(a.ngThumb);if(t.isFile(r.file)&&t.isImage(r.file)){var s=o.find("canvas"),c=new FileReader;c.onload=n,c.readAsDataURL(r.file)}}}}}]),asApp.directive("onErrorSrc",[function(){return{link:function(e,t,o){t.bind("error",function(){o.src!=o.onErrorSrc&&o.$set("src",o.onErrorSrc)})}}}]),asApp.directive("onFinishRender",["$timeout",function(e){return{restrict:"A",link:function(e,t,o){!0===e.$last&&e.$evalAsync(o.onFinishRender)}}}]),asApp.directive("setTagsClean",function(){return function(e,t,o){
var a=$(t),n="null"!==a.attr("tag")?a.attr("tag"):null,i="null"!==a.attr("value")?a.attr("value"):null,r=e.contentTags();r[n]=i,e.setTags(r)}}),asApp.directive("weRecommendYou",["$timeout",function(e){return{restrict:"E",scope:{articles:"=articles"},templateUrl:"/files/directives/we-recommend-you.html",link:function(e,t,o){}}}]);